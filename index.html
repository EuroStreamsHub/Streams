<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EuroStreamHub</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background:#121212;
  color:#f1faee;
}
header {
  display:flex;
  flex-direction:column;
  background:#0a3d62;
  color:white;
  position:sticky;
  top:0;
  z-index:1000;
}
header .top-bar {
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0.5rem 1rem;
}
header h1 {
  font-size:1.5rem;
}
header .menu-toggle {
  font-size:1.5rem;
  cursor:pointer;
}
header .buttons {
  display:flex;
  gap:0.5rem;
}
header .buttons button {
  background:#1f1f1f;
  color:#f1faee;
  border:none;
  border-radius:.3rem;
  padding:.4rem .8rem;
  font-weight:bold;
  cursor:pointer;
  transition:.2s;
}
header .buttons button.active {
  background:#ff6700; /* optional highlight */
}
#sidebar {
  background:#1f1f1f;
  display:none;
  flex-direction:column;
}
#sidebar a {
  padding:.6rem 1rem;
  color:#f1faee;
  text-decoration:none;
  border-bottom:1px solid #2c2c2c;
}
#sidebar a:hover { background:#0a3d62; }
#search-bar {
  width:90%;
  max-width:600px;
  margin:0.5rem auto;
  padding:.5rem;
  font-size:1rem;
  border-radius:.3rem;
  border:none;
  outline:none;
}
#matches {
  margin:1rem auto;
  max-width:800px;
}
.match-bar {
  display:flex;
  justify-content:space-between;
  padding:.5rem 1rem;
  background:#1f1f1f;
  margin:.3rem 0;
  border-radius:.3rem;
  cursor:pointer;
  transition:.2s;
}
.match-bar:hover { background:#0a3d62; }
.match-bar span { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.live-badge {
  background:#ff6700;
  color:white;
  font-weight:bold;
  font-size:0.75rem;
  padding:0 0.3rem;
  border-radius:.2rem;
  margin-left:.5rem;
}
</style>
</head>
<body>

<header>
  <div class="top-bar">
    <h1>EuroStreamHub</h1>
    <span class="menu-toggle">&#9776;</span>
  </div>
  <div id="sidebar"></div>
  <div class="buttons">
    <button id="live-today-btn">Live Today</button>
    <button id="live-now-btn">Live Now</button>
  </div>
  <input type="text" id="search-bar" placeholder="Search games or teams...">
</header>

<div id="matches"></div>

<script>
const API_BASE="https://streamed.pk/api";
let allSports=[], allMatches=[], filteredMatches=[];

const sidebar = document.getElementById("sidebar");
const matchesDiv = document.getElementById("matches");
const searchInput = document.getElementById("search-bar");
const liveTodayBtn = document.getElementById("live-today-btn");
const liveNowBtn = document.getElementById("live-now-btn");
const menuToggle = document.querySelector(".menu-toggle");

const DEFAULT_POSTER="";

// Sidebar toggle
menuToggle.addEventListener("click",()=>{
  sidebar.style.display = sidebar.style.display==="flex"?"none":"flex";
});

// Load sports
async function fetchSports(){
  const res = await fetch(`${API_BASE}/sports`);
  allSports = await res.json();
  sidebar.innerHTML = "";
  allSports.forEach(s=>{
    const a = document.createElement("a");
    a.textContent = s.name;
    a.href="#";
    a.addEventListener("click",()=> fetchMatches(s.id));
    sidebar.appendChild(a);
  });
}

// Fetch matches for a sport
async function fetchMatches(sportId){
  const res = await fetch(`${API_BASE}/matches/${sportId}`);
  const data = await res.json();
  allMatches = Array.isArray(data) ? data : (data.matches || []);
  filteredMatches = allMatches.sort((a,b)=>a.date-b.date);
  renderMatches(filteredMatches);
  sidebar.style.display="none";
}

// Render matches
function renderMatches(matches){
  matchesDiv.innerHTML = "";
  const now = Date.now();
  matches.forEach(m=>{
    const bar = document.createElement("div");
    bar.className="match-bar";
    const sport = m.sport || "#sport#";
    const teams = m.title || "Team A vs Team B";
    const kickoff = new Date(m.date);
    const diffHours = ((kickoff-now)/3600000).toFixed(1);
    bar.innerHTML=`<span>#${sport}#</span> <span>${teams}</span> <span>${diffHours}h from now</span>`;
    if(now>=m.date && now<=m.date+2*3600000){
      const badge = document.createElement("span");
      badge.className="live-badge";
      badge.textContent="LIVE";
      bar.appendChild(badge);
    }
    bar.addEventListener("click",()=> window.open(m.streams?.[0]?.url||"#","_blank"));
    matchesDiv.appendChild(bar);
  });
}

// Search
searchInput.addEventListener("input",()=>{
  const term = searchInput.value.toLowerCase();
  const filtered = filteredMatches.filter(m=>
    (m.title||"").toLowerCase().includes(term) || (m.sport||"").toLowerCase().includes(term)
  );
  renderMatches(filtered);
});

// Live Today button
liveTodayBtn.addEventListener("click",()=>{
  const today = new Date();
  today.setHours(0,0,0,0);
  const tomorrow = new Date(today);
  tomorrow.setDate(today.getDate()+1);
  const filtered = filteredMatches.filter(m=>{
    const d = new Date(m.date);
    return d>=today && d<tomorrow;
  });
  renderMatches(filtered);
});

// Live Now button
liveNowBtn.addEventListener("click",()=>{
  const now = Date.now();
  const filtered = filteredMatches.filter(m=>now>=m.date && now<=m.date+2*3600000);
  renderMatches(filtered);
});

// Initial load
fetchSports();
</script>

</body>
</html>  top:0;
  width:250px;
  height:100%;
  background:#1f1f1f;
  overflow-y:auto;
  padding-top:3rem;
  transition:0.3s;
  z-index:999;
}
.sidebar.active { left:0; }
.sidebar a {
  display:block;
  padding:1rem;
  color:#f1faee;
  text-decoration:none;
  border-bottom:1px solid #2c2c2c;
  transition:0.2s;
}
.sidebar a:hover { background:#0a3d62; }
#overlay {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.5);
  display:none;
  z-index:998;
}
#overlay.active { display:block; }

/* Controls & buttons */
.controls {
  max-width:1000px;
  margin:1rem auto;
  text-align:center;
}
.button {
  background:#1f1f1f;
  color:#f1faee;
  padding:.6rem 1rem;
  border:none;
  border-radius:.5rem;
  font-weight:600;
  cursor:pointer;
  margin:.2rem;
  transition:.2s;
}
.button.active {
  background:#0a3d62;
  color:#f1faee;
}

/* Match cards */
.match-date {
  font-weight:bold;
  font-size:1.2rem;
  margin-top:1.5rem;
  text-align:center;
}
.match-grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:1rem;
  margin-top:0.5rem;
  padding:0 1rem;
}
.match-card {
  position:relative;
  background:#1f1f1f;
  border-radius:.5rem;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  cursor:pointer;
  transition: transform 0.2s;
}
.match-card:hover { transform:translateY(-2px); }
.poster {
  flex-grow:1;
  width:100%;
  aspect-ratio:16/9;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#000;
}
.poster img { width:100%; height:100%; object-fit:cover; }
.match-title { font-weight:bold; font-size:1rem; padding:.5rem; }
.match-time { font-size:0.9rem; padding:.2rem .5rem .5rem; color:#bbb; }
.live-badge {
  position:absolute;
  bottom:0.5rem;
  right:0.5rem;
  background:#0a3d62;
  color:white;
  padding:0.2rem 0.5rem;
  border-radius:.3rem;
  font-size:0.8rem;
  font-weight:bold;
}

/* Responsive hamburger */
@media(max-width:768px){
  header h1 { font-size:1.2rem; }
  header .hamburger { display:block; }
}
</style>
</head>
<body>

<header>
  <span class="hamburger">&#9776;</span>
  <h1>EuroStreamHub</h1>
  <a href="#" class="button active" id="live-today-btn">Live Today</a>
</header>

<div class="sidebar" id="sidebar"></div>
<div id="overlay"></div>

<div class="controls">
  <div>
    <button class="button" id="popular-btn">Popular</button>
  </div>
</div>

<div id="match-container"></div>

<script>
const API_BASE="https://streamed.pk/api";
let allMatches=[], allSports=[];

const matchContainer=document.getElementById("match-container");
const popularBtn=document.getElementById("popular-btn");
const sidebar=document.getElementById("sidebar");
const overlay=document.getElementById("overlay");
const liveTodayBtn=document.getElementById("live-today-btn");
const hamburger=document.querySelector(".hamburger");

const DEFAULT_POSTER = "https://raw.githubusercontent.com/EuroStreamsHub/Streams/refs/heads/main/file_000000002878620aac8483fbedf5d310.png";

/* Sidebar toggle */
hamburger.addEventListener("click",()=>{ sidebar.classList.add("active"); overlay.classList.add("active"); });
overlay.addEventListener("click",()=>{ sidebar.classList.remove("active"); overlay.classList.remove("active"); });

/* Load sports into sidebar */
async function fetchSports(){
  try{
    const res=await fetch(`${API_BASE}/sports`);
    const data=await res.json();
    allSports = data;
    data.forEach(s=>{
      const link=document.createElement("a");
      link.href="#";
      link.textContent=s.name;
      link.addEventListener("click",()=>fetchMatches(s.id));
      sidebar.appendChild(link);
    });
  }catch(e){console.error("Sports fetch error:",e);}
}

/* Fetch matches for selected sport */
async function fetchMatches(sport){
  if(!sport) return;
  try{
    const res=await fetch(`${API_BASE}/matches/${sport}`);
    const data=await res.json();
    const matches = Array.isArray(data) ? data : (data.matches || []);
    allMatches = matches.filter(m=>m.date>0).sort((a,b)=>a.date-b.date);
    renderMatches();
    sidebar.classList.remove("active"); overlay.classList.remove("active");
  }catch(e){ console.error("Matches fetch error:",e); }
}

/* Format date */
function formatDate(ms){
  const d = new Date(ms);
  return d.toLocaleDateString([], { weekday:'long', day:'numeric', month:'short', year:'numeric' });
}

/* Render matches */
function renderMatches(filteredInput){
  matchContainer.innerHTML="";
  let filtered = filteredInput || allMatches.slice();
  const now=Date.now();

  if(popularBtn.classList.contains("active")){
    filtered = filtered.filter(m=>m.popular);
  }

  const grouped = {};
  filtered.forEach(m=>{
    const dateStr = formatDate(m.date);
    if(!grouped[dateStr]) grouped[dateStr] = [];
    grouped[dateStr].push(m);
  });

  Object.keys(grouped).forEach(dateStr=>{
    const dateDiv=document.createElement("div");
    dateDiv.className="match-date";
    dateDiv.textContent=dateStr;
    matchContainer.appendChild(dateDiv);

    const grid=document.createElement("div");
    grid.className="match-grid";

    grouped[dateStr].forEach(m=>{
      const card=document.createElement("div");
      card.className="match-card";

      const posterDiv=document.createElement("div");
      posterDiv.className="poster";
      const img=document.createElement("img");
      img.src = m.poster ? (m.poster.startsWith("http") ? m.poster : "https://streamed.pk" + m.poster) : DEFAULT_POSTER;
      img.onerror=()=>{img.src = DEFAULT_POSTER;};
      posterDiv.appendChild(img);
      card.appendChild(posterDiv);

      const titleDiv=document.createElement("div");
      titleDiv.className="match-title";
      titleDiv.textContent = m.title || "Match";

      const timeDiv=document.createElement("div");
      timeDiv.className="match-time";
      timeDiv.textContent = new Date(m.date).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

      card.appendChild(titleDiv);
      card.appendChild(timeDiv);

      if(now >= m.date && now <= m.date + 2*60*60*1000){
        const liveBadge=document.createElement("div");
        liveBadge.className="live-badge";
        liveBadge.textContent="LIVE";
        card.appendChild(liveBadge);
      }

      card.onclick=()=>{ 
        const matchParam=encodeURIComponent(JSON.stringify(m));
        window.location.href=`viewer.html?match=${matchParam}`;
      };

      grid.appendChild(card);
    });

    matchContainer.appendChild(grid);
  });
}

/* Toggle Popular button */
popularBtn.addEventListener("click",()=>{
  popularBtn.classList.toggle("active");
  renderMatches();
});

/* Live Today button: show all live matches */
liveTodayBtn.addEventListener("click",()=>{
  const now=Date.now();
  const liveMatches = allMatches.filter(m=>now>=m.date && now<=m.date+2*60*60*1000);
  renderMatches(liveMatches);
});

/* Initial load */
fetchSports();
</script>

</body>
</html>
