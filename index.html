<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sports Streams</title>
<style>
body {
  background:#369991;
  color:#f1faee;
  font-family:'Segoe UI',Roboto,sans-serif;
  padding:0;
  margin:0;
}
.controls {
  max-width:1000px;
  margin:0 auto 1rem;
  text-align:center;
  position:relative;
}
#search-input {
  background:#1f1f1f;
  color:#f1faee;
  padding:.6rem 1rem;
  border:none;
  border-radius:.5px;
  font-weight:600;
  cursor:text;
  margin:.2rem;
  width:60%;
}
.button {
  background:#1f1f1f;
  color:#f1faee;
  padding:.6rem 1rem;
  border:none;
  border-radius:.5rem;
  font-weight:600;
  cursor:pointer;
  margin:.2rem;
  transition:.2s;
}
.button.active { background:#FF6700; color:#f1faee; }

/* Hamburger sidebar */
#hamburger {
  display:inline-block;
  cursor:pointer;
  font-size:1.5rem;
  margin-left:1rem;
}
#sidebar {
  position:fixed;
  top:0;
  left:-250px;
  width:250px;
  height:100%;
  background:#1f1f1f;
  padding-top:2rem;
  transition:0.3s;
  overflow-y:auto;
  z-index:1000;
}
#sidebar a {
  display:block;
  color:#f1faee;
  padding:.8rem 1rem;
  text-decoration:none;
  font-weight:600;
}
#sidebar a:hover { background:#333; }

.match-date {
  font-weight:bold;
  font-size:1.2rem;
  margin-top:1.5rem;
  text-align:center;
}

.match-grid {
  display:block;
  margin-top:0;
}

.match-card {
  position:relative;
  background:#d3d3d3;
  border-radius:.5rem;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  padding:0;
  cursor:pointer;
  transition: transform 0.2s;
  width:100%;
  margin-bottom:0.5rem;
}
.match-card:hover { transform:translateY(-2px); }

.match-title {
  font-weight:bold;
  font-size:1rem;
  color:#000;
}
.match-time {
  font-size:0.9rem;
  color:#000;
}
.match-sport {
  font-size:0.9rem;
  font-weight:600;
  margin-bottom:0.2rem;
  color:#000;
}
.live-badge {
  position:absolute;
  bottom:0.5rem;
  right:0.5rem;
  background:red;
  color:white;
  padding:0.2rem 0.5rem;
  border-radius:.3rem;
  font-size:0.8rem;
  font-weight:bold;
}
</style>
</head>
<body>

<div class="controls">
  <input type="text" id="search-input" placeholder="Search matches...">
  <span id="hamburger">&#9776;</span>
  <div>
    <button class="button" id="live-btn">Live</button>
    <button class="button" id="popular-btn">Popular</button>
  </div>
</div>

<!-- Sidebar -->
<div id="sidebar"></div>

<div id="match-container"></div>

<script>
const API_BASE="https://streamed.pk/api";
let allMatches=[];
let sportsMap={}; // map sportId -> sport name

const matchContainer=document.getElementById("match-container");
const liveBtn=document.getElementById("live-btn");
const popularBtn=document.getElementById("popular-btn");
const searchInput=document.getElementById("search-input");
const hamburger=document.getElementById("hamburger");
const sidebar=document.getElementById("sidebar");

// Toggle sidebar
hamburger.addEventListener("click",()=>{
  sidebar.style.left = sidebar.style.left === "0px" ? "-250px" : "0px";
});

// Fetch sports
async function fetchSports(){
  try{
    const res=await fetch(`${API_BASE}/sports`);
    const sports=await res.json();
    sports.forEach(s=>{
      sportsMap[s.id]=s.name;
      const link=document.createElement("a");
      link.href="#";
      link.textContent=s.name;
      link.addEventListener("click",(e)=>{
        e.preventDefault();
        fetchMatches(s.id);
        sidebar.style.left="-250px"; // close sidebar
      });
      sidebar.appendChild(link);
    });
    await fetchAllMatches(sports);
  }catch(e){console.error("Sports fetch error:",e);}
}

// Fetch matches for a single sport
async function fetchMatches(sport){
  if(!sport) return;
  try{
    const res=await fetch(`${API_BASE}/matches/${sport}`);
    const data=await res.json();
    const matches = Array.isArray(data) ? data : (data.matches || []);
    allMatches = matches.filter(m=>m.date>0).sort((a,b)=>a.date-b.date);
    renderMatches();
  }catch(e){
    console.error("Matches fetch error:",e);
    matchContainer.innerHTML="<p>⚠️ No matches available for this sport.</p>";
  }
}

// Fetch all matches (for live page load)
async function fetchAllMatches(sports){
  allMatches = [];
  for(const s of sports){
    try{
      const res=await fetch(`${API_BASE}/matches/${s.id}`);
      const data=await res.json();
      const matches = Array.isArray(data) ? data : (data.matches || []);
      allMatches.push(...matches.filter(m=>m.date>0));
    }catch(e){console.error("Error fetching sport", s.name, e);}
  }
  // Show only currently live matches on load
  const now=Date.now();
  const liveMatches = allMatches.filter(m=>m.date <= now && now <= m.date + 2*60*60*1000);
  renderMatches(liveMatches);
}

function formatDate(ms){
  const d = new Date(ms);
  return d.toLocaleDateString([], { weekday:'long', day:'numeric', month:'short', year:'numeric' });
}

// Render matches
function renderMatches(filteredInput){
  matchContainer.innerHTML="";
  let filtered = filteredInput || allMatches.slice();
  const now=Date.now();

  if(liveBtn.classList.contains("active")){
    filtered = filtered.filter(m=>m.date <= now && now <= m.date + 2*60*60*1000);
  }
  if(popularBtn.classList.contains("active")){
    filtered = filtered.filter(m=>m.popular);
  }

  const grouped = {};
  filtered.forEach(m=>{
    const dateStr = formatDate(m.date);
    if(!grouped[dateStr]) grouped[dateStr] = [];
    grouped[dateStr].push(m);
  });

  Object.keys(grouped).forEach(dateStr=>{
    const dateDiv=document.createElement("div");
    dateDiv.className="match-date";
    dateDiv.textContent=dateStr;
    matchContainer.appendChild(dateDiv);

    const grid=document.createElement("div");
    grid.className="match-grid";

    grouped[dateStr].forEach(m=>{
      const card=document.createElement("a");
      card.className="match-card";
      card.href = `viewer.html?match=${encodeURIComponent(JSON.stringify(m))}`;

      const sportDiv = document.createElement("div");
      sportDiv.className="match-sport";
      sportDiv.textContent = sportsMap[m.sport] || m.sport || "";
      card.appendChild(sportDiv);

      const titleDiv=document.createElement("div");
      titleDiv.className="match-title";
      titleDiv.textContent = m.title || "Match";
      card.appendChild(titleDiv);

      const timeDiv=document.createElement("div");
      timeDiv.className="match-time";
      timeDiv.textContent = new Date(m.date).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
      card.appendChild(timeDiv);

      if(now >= m.date && now <= m.date + 2*60*60*1000){
        const liveBadge=document.createElement("div");
        liveBadge.className="live-badge";
        liveBadge.textContent="LIVE";
        card.appendChild(liveBadge);
      }

      grid.appendChild(card);
    });

    matchContainer.appendChild(grid);
  });
}

// Search
searchInput.addEventListener("input",()=>{
  const query = searchInput.value.toLowerCase();
  const filtered = allMatches.filter(m=>m.title.toLowerCase().includes(query));
  renderMatches(filtered);
});

// Button toggles
liveBtn.addEventListener("click",()=>{
  liveBtn.classList.toggle("active");
  renderMatches();
});
popularBtn.addEventListener("click",()=>{
  popularBtn.classList.toggle("active");
  renderMatches();
});

fetchSports();
</script>
</body>
</html>
