<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EuroStreamHub - Live Today</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background:#121212;
  color:#f1faee;
}
header {
  background:#0a3d62;
  color:white;
  padding:0.5rem 1rem;
  position:sticky;
  top:0;
  z-index:1000;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1 {
  font-size:1.5rem;
}
#matches {
  margin:1rem auto;
  max-width:800px;
}
.match-link {
  display:block;
  background:#1f1f1f;
  color:#f1faee;
  text-decoration:none;
  padding:0.8rem 1rem;
  margin:0.5rem 0;
  border-radius:5px;
  transition:0.2s;
}
.match-link:hover { background:#0a3d62; }
.match-line {
  display:flex;
  justify-content:space-between;
  margin:0.2rem 0;
}
.match-line span {
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.live-badge {
  background:#ff6700;
  color:white;
  font-weight:bold;
  font-size:0.75rem;
  padding:0 0.3rem;
  border-radius:0.2rem;
  margin-left:0.5rem;
}
</style>
</head>
<body>

<header>
  <h1>EuroStreamHub</h1>
</header>

<div id="matches"></div>

<script>
const API_BASE = "https://streamed.pk/api";
const matchesDiv = document.getElementById("matches");
const now = Date.now();

// Fetch all sports
async function fetchSports() {
  try {
    const res = await fetch(`${API_BASE}/sports`);
    return await res.json();
  } catch(e) { console.error("Sports fetch error:", e); return []; }
}

// Fetch matches for a sport
async function fetchMatchesForSport(sportId) {
  try {
    const res = await fetch(`${API_BASE}/matches/${sportId}`);
    const data = await res.json();
    return Array.isArray(data) ? data : (data.matches || []);
  } catch(e) { console.error("Matches fetch error:", e); return []; }
}

// Filter matches for today
function filterToday(matches) {
  const today = new Date();
  today.setHours(0,0,0,0);
  const tomorrow = new Date(today);
  tomorrow.setDate(today.getDate()+1);
  return matches.filter(m => {
    const d = new Date(m.date);
    return d >= today && d < tomorrow;
  });
}

// Render matches in 3-line bars
function renderMatches(matches) {
  matchesDiv.innerHTML = "";
  matches.forEach(m => {
    const link = document.createElement("a");
    link.href = m.streams?.[0]?.url || "#";
    link.className = "match-link";
    link.target = "_blank"; // open in new tab

    // Line 1: Sport
    const line1 = document.createElement("div");
    line1.className = "match-line";
    const sportSpan = document.createElement("span");
    sportSpan.textContent = m.sport || "#sport#";
    sportSpan.style.fontWeight = "bold";
    line1.appendChild(sportSpan);

    // Line 2: Teams
    const line2 = document.createElement("div");
    line2.className = "match-line";
    const teamsSpan = document.createElement("span");
    teamsSpan.textContent = m.title || "Team A vs Team B";
    line2.appendChild(teamsSpan);

    // Line 3: Kickoff
    const line3 = document.createElement("div");
    line3.className = "match-line";
    const kickoffSpan = document.createElement("span");
    const kickoff = new Date(m.date);
    const diffHours = ((kickoff - now)/3600000).toFixed(1);
    kickoffSpan.textContent = diffHours + "h from now";
    // LIVE badge
    if(now >= m.date && now <= m.date + 2*3600000) {
      const liveBadge = document.createElement("span");
      liveBadge.className = "live-badge";
      liveBadge.textContent = "LIVE";
      kickoffSpan.appendChild(liveBadge);
    }
    line3.appendChild(kickoffSpan);

    // Append all lines
    link.appendChild(line1);
    link.appendChild(line2);
    link.appendChild(line3);

    matchesDiv.appendChild(link);
  });
}

// Load all matches today
async function loadTodayMatches() {
  const sports = await fetchSports();
  let allMatches = [];
  for(const sport of sports) {
    const matches = await fetchMatchesForSport(sport.id);
    allMatches = allMatches.concat(matches.map(m=>({...m, sport: sport.name})));
  }
  const todayMatches = filterToday(allMatches).sort((a,b)=>a.date-b.date);
  renderMatches(todayMatches);
}

// Run on page load
loadTodayMatches();
</script>

</body>
</html>
