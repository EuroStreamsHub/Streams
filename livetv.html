<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live TV</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background: radial-gradient(circle at top, #1e1e1e, #0b0b0b);
  color:#fff;
  text-align:center;
}

/* Header + controls */
.header {
  padding:1rem;
}
.controls {
  display:flex;
  justify-content:center;
  align-items:center;
  gap:.5rem;
  flex-wrap:wrap;
  margin-bottom:1rem;
}
.controls input {
  padding:.6rem 1rem;
  border-radius:.4rem;
  border:none;
  width:200px;
}

/* Grid layout */
.grid {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:1rem;
  padding:1rem;
}
@media(min-width:900px){ .grid { grid-template-columns:repeat(3,1fr); } }
@media(min-width:1200px){ .grid { grid-template-columns:repeat(4,1fr); } }

/* Card 9:16 */
.card {
  background:#121212;
  border-radius:.7rem;
  overflow:hidden;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  aspect-ratio:9/16;
  transition:.2s;
}
.card:hover { transform:scale(1.03); }

/* Top logo half */
.poster {
  flex:1;
  background:#1e1e1e;
  background-size:contain;
  background-repeat:no-repeat;
  background-position:center;
}

/* Bottom info */
.info {
  flex:1;
  background:#181818;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  font-weight:600;
  font-size:.95rem;
  padding:.5rem;
}
</style>
</head>
<body>

<div class="header">
  <h2>Live TV</h2>
  <div class="controls">
    <input id="search" placeholder="Search channelsâ€¦">
  </div>
</div>

<div id="grid" class="grid"></div>

<script>
const grid = document.getElementById("grid");
const searchInput = document.getElementById("search");

// Load hashtags.json for country folder mapping
let hashtags = {};
fetch('https://raw.githubusercontent.com/EuroStreamsHub/Streams/refs/heads/main/hashtag.json')
  .then(r => r.json())
  .then(data => hashtags = data)
  .then(init);

// Format API channel name to GitHub logo style
function formatChannelName(name) {
  name = name.replace(/\[.*?\]/,'');       // remove [COUNTRY]
  name = name.replace(/([a-z])([A-Z0-9])/g,'$1-$2'); // insert hyphen
  name = name.replace(/\s+/g,'-');         // spaces to hyphen
  return name.toLowerCase();
}

// Fetch API channels and render
async function init() {
  const res = await fetch('https://beta.adstrim.ru/api/channels');
  const data = await res.json();
  const channels = data.channels.filter(c => c.show_on_livetv);

  function render() {
    const q = searchInput.value.toLowerCase();
    grid.innerHTML = '';

    channels.forEach(c => {
      const countryMatch = c.name.match(/\[(.*?)\]/);
      let countryKey = countryMatch ? countryMatch[1] : '';
      let countryFolder = hashtags[countryKey] || countryKey.toLowerCase();

      const formattedName = formatChannelName(c.name);
      const countryCode = countryKey.toLowerCase();
      const logoUrl = `https://raw.githubusercontent.com/tv-logo/tv-logos/refs/heads/main/countries/${countryFolder}/${formattedName}-${countryCode}.png`;

      // Filter by search
      if(!c.name.toLowerCase().includes(q)) return;

      const card = document.createElement('div');
      card.className = 'card';

      const poster = document.createElement('div');
      poster.className = 'poster';
      poster.style.backgroundImage = `url(${logoUrl})`;

      const info = document.createElement('div');
      info.className = 'info';
      info.textContent = c.onsatname || c.name;

      card.appendChild(poster);
      card.appendChild(info);

      // Click to viewer
      card.onclick = () => {
        const url = `viewer.html?type=livetv&channel=${encodeURIComponent(c.name)}&title=${encodeURIComponent(c.onsatname||c.name)}`;
        window.location.href = url;
      };

      grid.appendChild(card);
    });
  }

  searchInput.oninput = render;
  render();
}
</script>
</body>
</html>
