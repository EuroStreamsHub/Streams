<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live TV</title>

<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background:radial-gradient(circle at top,#1e1e1e,#0b0b0b);
  color:#fff;
}

/* Header */
.header {
  padding:1rem;
  text-align:center;
}

/* Controls */
.controls {
  display:flex;
  justify-content:center;
  margin-bottom:1rem;
}

.controls input {
  width:260px;
  max-width:90%;
  padding:.6rem 1rem;
  border:none;
  border-radius:.4rem;
}

/* Grid */
.grid {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:1rem;
  padding:1rem;
}

@media(min-width:900px){
  .grid { grid-template-columns:repeat(3,1fr); }
}
@media(min-width:1200px){
  .grid { grid-template-columns:repeat(4,1fr); }
}

/* Card */
.card {
  background:#121212;
  border-radius:.7rem;
  overflow:hidden;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  aspect-ratio:9/16;
  transition:.2s;
}
.card:hover { transform:scale(1.04); }

/* Logo area (top half) */
.logo-box {
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#000;
}

.logo-box img {
  max-width:90%;
  max-height:60%;
  object-fit:contain;
}

/* Info (bottom half) */
.info {
  flex:1;
  background:#181818;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:.6rem;
  font-weight:600;
  font-size:.95rem;
}
</style>
</head>

<body>

<div class="header">
  <h2>Live TV</h2>
  <div class="controls">
    <input id="search" placeholder="Search channelsâ€¦">
  </div>
</div>

<div id="grid" class="grid"></div>

<script>
const grid = document.getElementById("grid");
const searchInput = document.getElementById("search");

let channels = [];
let hashtagMap = {};

/* Load hashtag.json */
async function loadHashtags(){
  const res = await fetch("hashtag.json");
  hashtagMap = await res.json();
}

/* Fetch channels */
async function loadChannels(){
  const res = await fetch("https://beta.adstrim.ru/api/channels");
  const data = await res.json();
  channels = data.channels.filter(c => c.show_on_livetv && !c.hide);
  render();
}

/* Build logo URL */
function getLogoUrl(name){
  // Extract country code inside [ ]
  const match = name.match(/\[(.*?)\]/);
  if(!match) return null;

  const code = match[1];
  const countryFolder = hashtagMap[code];
  if(!countryFolder) return null;

  // Slugify channel name
  const slug = name
    .replace(/\[.*?\]/g,"")
    .toLowerCase()
    .trim()
    .replace(/\s+/g,"-");

  return `https://raw.githubusercontent.com/tv-logo/tv-logos/refs/heads/main/countries/${countryFolder}/${slug}-${code.toLowerCase()}.png`;
}

/* Render grid */
function render(){
  grid.innerHTML = "";
  const q = searchInput.value.toLowerCase();

  channels
    .filter(c => c.name.toLowerCase().includes(q))
    .forEach(c=>{
      const card = document.createElement("div");
      card.className = "card";

      const logoBox = document.createElement("div");
      logoBox.className = "logo-box";

      const img = document.createElement("img");
      const logo = getLogoUrl(c.name);

      if(logo){
        img.src = logo;
        img.onerror = ()=>img.remove();
        logoBox.appendChild(img);
      }

      const info = document.createElement("div");
      info.className = "info";
      info.textContent = c.name.replace(/\[.*?\]/,"").trim();

      card.appendChild(logoBox);
      card.appendChild(info);

      card.onclick = ()=>{
        location.href =
          `viewer.html?type=livetv&channel=${encodeURIComponent(c.name)}`;
      };

      grid.appendChild(card);
    });
}

searchInput.oninput = render;

/* Init */
(async()=>{
  await loadHashtags();
  await loadChannels();
})();
</script>

</body>
</html>
