<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live TV</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background: radial-gradient(circle at top, #1e1e1e, #0b0b0b);
  color:#fff;
}
.header {
  text-align:center;
  padding:1rem;
}
.controls {
  display:flex;
  justify-content:center;
  gap:1rem;
  margin-bottom:1rem;
}
.controls input {
  padding:.6rem 1rem;
  border-radius:.4rem;
  border:none;
  width:220px;
}
.grid {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:1rem;
  padding:1rem;
}
@media(min-width:900px){ .grid{ grid-template-columns:repeat(3,1fr); } }
@media(min-width:1200px){ .grid{ grid-template-columns:repeat(4,1fr); } }
.card {
  background:#121212;
  border-radius:.7rem;
  overflow:hidden;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  aspect-ratio:9/16;
  transition:.2s;
}
.card:hover{ transform:scale(1.04); }
.logo {
  flex:1;
  background-size:contain;
  background-repeat:no-repeat;
  background-position:center;
  background-color:#000;
}
.info {
  flex:.3;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:.4rem;
  font-weight:600;
  font-size:.95rem;
  background:#181818;
}
</style>
</head>
<body>

<div class="header">
  <h2>Live TV</h2>
  <div class="controls">
    <input id="search" placeholder="Search channelsâ€¦">
  </div>
</div>

<div id="grid" class="grid"></div>

<script>
const grid = document.getElementById("grid");
const searchInput = document.getElementById("search");

let channels = [];
let hashtags = {};

/* ---------- FETCH HASHTAGS JSON ---------- */
async function loadHashtags() {
  const res = await fetch("https://raw.githubusercontent.com/EuroStreamsHub/Streams/refs/heads/main/hashtag.json");
  hashtags = await res.json();
}

/* ---------- FETCH CHANNELS ---------- */
async function loadChannels() {
  const res = await fetch("https://beta.adstrim.ru/api/channels");
  const data = await res.json();
  channels = data.channels.filter(c=>c.show_on_livetv);
  render();
}

/* ---------- RENDER GRID ---------- */
function render() {
  const q = searchInput.value.toLowerCase();
  grid.innerHTML = "";

  channels
    .filter(c => c.name.toLowerCase().includes(q))
    .forEach(c => {
      const card = document.createElement("div");
      card.className="card";

      /* Build logo URL from hashtag.json */
      let country = c.name.match(/\[(.*?)\]/);
      country = country ? country[1] : "international";
      const countryData = hashtags[country] || hashtags["International"] || {folder:"international", code:"int"};

      // Format name for GitHub file
      let fileName = c.name.replace(/\[.*?\]/,"") // remove [UK]
                        .replace(/\s+/g,"-")
                        .replace(/[^a-zA-Z0-9\-]/g,"")
                        .toLowerCase();
      const logoUrl = `https://raw.githubusercontent.com/tv-logo/tv-logos/refs/heads/main/countries/${countryData.folder}/${fileName}-${countryData.code}.png`;

      const logoDiv = document.createElement("div");
      logoDiv.className="logo";
      logoDiv.style.backgroundImage=`url(${logoUrl})`;

      const infoDiv = document.createElement("div");
      infoDiv.className="info";
      infoDiv.textContent = c.name.replace(/\[.*?\]/,"");

      card.appendChild(logoDiv);
      card.appendChild(infoDiv);

      /* Click to viewer */
      card.onclick = () => {
        const encoded = encodeURIComponent(c.name);
        window.location.href = `viewer.html?type=livetv&channel=${encoded}&title=${encodeURIComponent(c.name)}`;
      };

      grid.appendChild(card);
    });
}

/* ---------- EVENTS ---------- */
searchInput.oninput = render;

/* ---------- INIT ---------- */
async function init() {
  await loadHashtags();
  await loadChannels();
}

init();
</script>

</body>
</html>
