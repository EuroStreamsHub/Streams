<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live TV</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background: radial-gradient(circle at top, #1e1e1e, #0b0b0b);
  color:#fff;
}
.header {
  padding:1rem;
  text-align:center;
}
.controls {
  display:flex;
  justify-content:center;
  gap:.5rem;
  flex-wrap:wrap;
  margin-bottom:1rem;
}
.controls input {
  padding:.6rem 1rem;
  border-radius:.4rem;
  border:none;
  width:220px;
  max-width:90%;
}
.grid {
  display:flex;
  flex-direction:column;
  gap:.5rem;
  padding:1rem;
}
.card {
  background:#121212;
  border-radius:.5rem;
  padding:.8rem 1rem;
  cursor:pointer;
  transition:.2s;
  font-weight:600;
}
.card:hover { background:#ff6700; color:#000; }
</style>
</head>
<body>

<div class="header">
  <h2>Live TV Channels</h2>
  <div class="controls">
    <input id="search" placeholder="Search channelsâ€¦">
  </div>
</div>

<div id="grid" class="grid"></div>

<script>
const grid = document.getElementById("grid");
const searchInput = document.getElementById("search");

let channels = [];

// Fetch channels from API
async function fetchChannels(){
  const res = await fetch("https://beta.adstrim.ru/api/channels");
  const data = await res.json();
  channels = data.channels.filter(c=>c.show_on_livetv);
  render();
}

// Format name: remove [Country] and add spaces before capital letters
function formatName(name){
  let n = name.replace(/\[.*?\]/,''); // remove [Country]
  n = n.replace(/([a-z])([A-Z])/g,'$1 $2'); // add space before capitals
  return n.trim();
}

// Render channels
function render(){
  grid.innerHTML = "";
  const q = searchInput.value.toLowerCase();

  channels.filter(c=>c.name.toLowerCase().includes(q)).forEach(c=>{
    const card = document.createElement("div");
    card.className = "card";
    card.textContent = formatName(c.name);

    card.onclick = ()=>{
      // open in viewer.html
      location.href = `viewer.html?type=livetv&channel=${encodeURIComponent(c.name)}&title=${encodeURIComponent(formatName(c.name))}`;
    };

    grid.appendChild(card);
  });
}

searchInput.oninput = render;

// Initial load
fetchChannels();
</script>
</body>
</html>
