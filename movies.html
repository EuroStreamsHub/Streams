<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movies</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background: radial-gradient(circle at top, #1e1e1e, #0b0b0b);
  color:#fff;
}

.header {
  padding:1rem;
  text-align:center;
}

.controls {
  display:flex;
  justify-content:center;
  gap:.5rem;
  flex-wrap:wrap;
  position:sticky;
  top:0;
  background:#121212;
  padding:.5rem 1rem;
  z-index:10;
}

button.back-home {
  background:#1f1f1f;
  color:#fff;
  padding:.5rem 1rem;
  border:none;
  border-radius:.4rem;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
button.back-home:hover { background:#ff6700; color:#000; }

input {
  padding:.6rem 1rem;
  border-radius:.4rem;
  border:none;
  width:200px;
}

button.category-btn {
  padding:.6rem 1rem;
  border:none;
  border-radius:.4rem;
  background:#ff6700;
  color:#000;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
button.category-btn:hover { background:#ff8c33; }

.section {
  margin:1rem 0;
}

.section h3 {
  margin-left:1rem;
  margin-bottom:.5rem;
}

.carousel {
  display:flex;
  overflow-x:auto;
  gap:1rem;
  padding-left:1rem;
  scroll-behavior:smooth;
}
.carousel::-webkit-scrollbar {
  height:8px;
}
.carousel::-webkit-scrollbar-thumb {
  background:#ff6700;
  border-radius:4px;
}

.card {
  cursor:pointer;
  flex:0 0 160px;
  transition:.2s;
}
.card:hover { transform:scale(1.04); }

.poster {
  width:100%;
  aspect-ratio:2/3;
  border-radius:.5rem;
  background-size:cover;
  background-position:center;
}

.title {
  margin-top:.4rem;
  font-size:.9rem;
  text-align:center;
}
</style>
</head>
<body>

<div class="header">
  <h2>Movies</h2>
  <div class="controls">
    <button class="back-home" onclick="goHome()">⬅ Home</button>
    <input id="search" placeholder="Search movies…">
    <button onclick="searchMovies()">Search</button>
  </div>
</div>

<!-- Popular Section -->
<div class="section">
  <h3>Popular</h3>
  <div id="popular" class="carousel"></div>
</div>

<!-- Trending Section -->
<div class="section">
  <h3>Trending</h3>
  <div id="trending" class="carousel"></div>
</div>

<!-- Recent Section -->
<div class="section">
  <h3>Recent</h3>
  <div id="recent" class="carousel"></div>
</div>

<script>
const API_KEY = "12955008668c12c07496b04132f9ce44";
const IMG = "https://image.tmdb.org/t/p/w500";

const popularDiv = document.getElementById("popular");
const trendingDiv = document.getElementById("trending");
const recentDiv = document.getElementById("recent");
const searchInput = document.getElementById("search");

// Back button
function goHome() {
  window.location.href = "index.html";
}

// Get IMDb ID
async function getImdbId(tmdbId) {
  const res = await fetch(
    `https://api.themoviedb.org/3/movie/${tmdbId}?api_key=${API_KEY}`
  );
  const data = await res.json();
  return data.imdb_id;
}

// Render a section
function renderSection(list, container) {
  container.innerHTML = "";
  list.forEach(movie => {
    if (!movie.poster_path) return;

    const card = document.createElement("div");
    card.className = "card";

    const poster = document.createElement("div");
    poster.className = "poster";
    poster.style.backgroundImage = `url(${IMG}${movie.poster_path})`;

    const title = document.createElement("div");
    title.className = "title";
    title.textContent = movie.title;

    card.appendChild(poster);
    card.appendChild(title);

    card.onclick = async () => {
      const imdb = await getImdbId(movie.id);
      if (!imdb) return alert("No IMDb ID");
      location.href =
        `viewer.html?type=movie&imdb=${imdb}&title=${encodeURIComponent(movie.title)}`;
    };

    container.appendChild(card);
  });
}

// Load Popular
async function loadPopular() {
  const res = await fetch(
    `https://api.themoviedb.org/3/movie/popular?api_key=${API_KEY}&language=en-US&page=1`
  );
  const data = await res.json();
  renderSection(data.results, popularDiv);
}

// Load Trending
async function loadTrending() {
  const res = await fetch(
    `https://api.themoviedb.org/3/trending/movie/day?api_key=${API_KEY}`
  );
  const data = await res.json();
  renderSection(data.results, trendingDiv);
}

// Load Recent / Now Playing
async function loadRecent() {
  const res = await fetch(
    `https://api.themoviedb.org/3/movie/now_playing?api_key=${API_KEY}&language=en-US&page=1`
  );
  const data = await res.json();
  renderSection(data.results, recentDiv);
}

// Search
async function searchMovies() {
  const q = searchInput.value.trim();
  if (!q) return;
  const res = await fetch(
    `https://api.themoviedb.org/3/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(q)}`
  );
  const data = await res.json();
  // Replace all sections with search results
  renderSection(data.results, popularDiv);
  trendingDiv.innerHTML = "";
  recentDiv.innerHTML = "";
}

// Press Enter to search
searchInput.addEventListener("keypress", e => {
  if(e.key === "Enter") searchMovies();
});

// Initial load
loadPopular();
loadTrending();
loadRecent();
</script>

</body>
</html>
