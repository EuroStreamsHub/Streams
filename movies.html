<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Streaming Hub</title>
<style>
  :root {
    --primary: #e50914;
    --bg: #141414;
    --surface: #1f1f1f;
    --text: #ffffff;
  }

  body {
    margin: 0;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background-color: var(--bg);
    color: var(--text);
    overflow-x: hidden;
  }

  /* Navigation */
  header {
    background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, transparent 100%);
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
    padding: 1.2rem 4%;
    display: flex;
    align-items: center;
    box-sizing: border-box;
  }

  .logo {
    color: var(--primary);
    font-size: 1.8rem;
    font-weight: bold;
    text-transform: uppercase;
    margin-right: 2rem;
    cursor: pointer;
    text-decoration: none;
  }

  .search-box {
    background: rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.5);
    padding: 6px 12px;
    display: flex;
    align-items: center;
    border-radius: 4px;
  }

  .search-box input {
    background: transparent;
    border: none;
    color: white;
    outline: none;
    width: 250px;
    font-size: 0.9rem;
  }

  /* Hero Section */
  .hero {
    height: 80vh;
    background-size: cover;
    background-position: center 20%;
    display: flex;
    align-items: center;
    padding: 0 4%;
    position: relative;
  }

  .hero::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; width: 100%; height: 250px;
    background: linear-gradient(to top, var(--bg), transparent);
  }

  .hero-content {
    max-width: 650px;
    z-index: 2;
    text-shadow: 2px 2px 10px rgba(0,0,0,0.8);
  }

  .hero-title { font-size: 4rem; margin: 0; font-weight: bold; line-height: 1.1; }
  .hero-desc { font-size: 1.2rem; margin: 1.5rem 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

  .btn-play {
    background: white;
    color: black;
    padding: 0.8rem 2.5rem;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    font-size: 1.2rem;
    cursor: pointer;
    transition: opacity 0.2s;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .btn-play:hover { background: rgba(255,255,255,0.8); }

  /* Genre Filter */
  .genre-bar {
    padding: 20px 4% 0;
    display: flex;
    gap: 10px;
    overflow-x: auto;
    scrollbar-width: none;
  }
  .genre-bar::-webkit-scrollbar { display: none; }

  .genre-tag {
    background: var(--surface);
    padding: 8px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
    white-space: nowrap;
    transition: 0.3s;
    border: 1px solid transparent;
  }
  .genre-tag.active { border-color: white; background: #333; }

  /* Carousels */
  .section { margin: 2.5rem 0; padding: 0 4%; }
  .section h3 { font-size: 1.5rem; margin-bottom: 1rem; color: #e5e5e5; }

  .carousel {
    display: flex;
    gap: 0.6rem;
    overflow-x: auto;
    padding: 15px 0;
    scrollbar-width: none;
  }
  .carousel::-webkit-scrollbar { display: none; }

  .card {
    flex: 0 0 240px;
    cursor: pointer;
    transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
  }
  .card:hover { transform: scale(1.08); z-index: 5; }

  .poster {
    width: 100%;
    aspect-ratio: 16/9;
    background-size: cover;
    background-position: center;
    border-radius: 4px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  }

  .card-title {
    margin-top: 8px;
    font-size: 0.85rem;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>
</head>
<body>

<header>
  <a href="#" class="logo" onclick="location.reload()">STREAM</a>
  <div class="search-box">
    <input id="search" placeholder="Search titles or genres..." onkeypress="handleSearch(event)">
  </div>
</header>

<div id="hero" class="hero">
  <div class="hero-content">
    <h1 id="heroTitle" class="hero-title">...</h1>
    <p id="heroDesc" class="hero-desc">...</p>
    <button id="heroPlayBtn" class="btn-play">â–¶ Play</button>
  </div>
</div>

<div class="genre-bar" id="genreBar">
  <div class="genre-tag active" onclick="filterByGenre(null, this)">All Movies</div>
</div>

<div class="section">
  <h3 id="rowTitle">Popular Now</h3>
  <div id="mainGrid" class="carousel"></div>
</div>

<div class="section">
  <h3>Top Trending</h3>
  <div id="trending" class="carousel"></div>
</div>

<script>
const API_KEY = "12955008668c12c07496b04132f9ce44";
const IMG_FULL = "https://image.tmdb.org/t/p/w1280";
const IMG_THUMB = "https://image.tmdb.org/t/p/w500";

// Navigate to Viewer
async function playMovie(tmdbId, title) {
  const res = await fetch(`https://api.themoviedb.org/3/movie/${tmdbId}?api_key=${API_KEY}`);
  const data = await res.json();
  if(data.imdb_id) {
    location.href = `viewer.html?type=movie&imdb=${data.imdb_id}&title=${encodeURIComponent(title)}`;
  } else {
    alert("Streaming source not found for this title.");
  }
}

// Setup Hero
async function initHero() {
  const res = await fetch(`https://api.themoviedb.org/3/trending/movie/day?api_key=${API_KEY}`);
  const data = await res.json();
  const movie = data.results[0];
  
  document.getElementById('hero').style.backgroundImage = `linear-gradient(to right, rgba(0,0,0,0.9), transparent), url(${IMG_FULL}${movie.backdrop_path})`;
  document.getElementById('heroTitle').innerText = movie.title;
  document.getElementById('heroDesc').innerText = movie.overview;
  
  // Make big Play button work
  document.getElementById('heroPlayBtn').onclick = () => playMovie(movie.id, movie.title);
}

// Load Genres
async function loadGenres() {
  const res = await fetch(`https://api.themoviedb.org/3/genre/movie/list?api_key=${API_KEY}`);
  const data = await res.json();
  const bar = document.getElementById('genreBar');
  data.genres.slice(0, 10).forEach(g => {
    const tag = document.createElement('div');
    tag.className = 'genre-tag';
    tag.innerText = g.name;
    tag.onclick = () => filterByGenre(g.id, tag);
    bar.appendChild(tag);
  });
}

function renderCarousel(list, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  list.forEach(movie => {
    if (!movie.backdrop_path) return;
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="poster" style="background-image: url(${IMG_THUMB}${movie.backdrop_path})"></div>
      <div class="card-title">${movie.title}</div>
    `;
    card.onclick = () => playMovie(movie.id, movie.title);
    container.appendChild(card);
  });
}

async function filterByGenre(id, el) {
  document.querySelectorAll('.genre-tag').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  const url = id 
    ? `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&with_genres=${id}`
    : `https://api.themoviedb.org/3/movie/popular?api_key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  document.getElementById('rowTitle').innerText = id ? `Top ${el.innerText}` : "Popular Now";
  renderCarousel(data.results, 'mainGrid');
}

function handleSearch(e) {
  if (e.key === 'Enter') {
    fetch(`https://api.themoviedb.org/3/search/movie?api_key=${API_KEY}&query=${e.target.value}`)
      .then(res => res.json())
      .then(data => {
        document.getElementById('rowTitle').innerText = "Search Results";
        renderCarousel(data.results, 'mainGrid');
        window.scrollTo({top: 500, behavior: 'smooth'});
      });
  }
}

// Start
initHero();
loadGenres();
filterByGenre(null, document.querySelector('.genre-tag'));
fetch(`https://api.themoviedb.org/3/movie/top_rated?api_key=${API_KEY}`).then(r => r.json()).then(d => renderCarousel(d.results, 'trending'));
</script>

</body>
</html>
