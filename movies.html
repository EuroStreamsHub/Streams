<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stream Portal | Movies & Series</title>
<style>
  :root {
    --primary: #e50914;
    --bg: #0a0b0d;
    --surface: #16181d;
    --text: #ffffff;
    --gray: #9ca3af;
  }

  body {
    margin: 0;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background-color: var(--bg);
    color: var(--text);
    overflow-x: hidden;
  }

  /* Navigation Bar */
  header {
    background: rgba(0,0,0,0.9);
    position: fixed;
    top: 0; width: 100%; z-index: 1000;
    padding: 1rem 4%;
    display: flex;
    align-items: center;
    box-sizing: border-box;
    gap: 20px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .logo {
    color: var(--primary);
    font-size: 1.5rem;
    font-weight: 900;
    text-decoration: none;
    letter-spacing: -1px;
  }

  /* Mode Switch */
  .mode-switch {
    display: flex;
    background: rgba(255,255,255,0.1);
    padding: 3px;
    border-radius: 8px;
  }

  .mode-btn {
    padding: 6px 15px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: white;
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 700;
    transition: 0.3s;
  }

  .mode-btn.active { background: var(--primary); }

  /* Dynamic Search Area */
  .search-container {
    padding: 100px 4% 20px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .search-bar-wrapper {
    position: relative;
    width: 100%;
    margin-bottom: 2rem;
  }

  input#search {
    width: 100%;
    background: var(--surface);
    border: 1px solid #333;
    padding: 15px 20px;
    border-radius: 10px;
    color: white;
    font-size: 1.1rem;
    outline: none;
    transition: 0.3s;
  }

  input#search:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(229, 9, 20, 0.2); }

  /* Content Grid */
  .content-section {
    padding: 0 4% 4rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  .section-header {
    font-size: 1.8rem;
    font-weight: 800;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .section-header span { color: var(--primary); }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 20px;
  }

  .card {
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .card:hover { transform: scale(1.05); }

  .poster {
    width: 100%;
    aspect-ratio: 16/9;
    background-size: cover;
    background-position: center;
    border-radius: 8px;
    background-color: #222;
    border: 1px solid rgba(255,255,255,0.05);
  }

  .card-info {
    margin-top: 10px;
  }

  .card-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 4px; }
  .card-meta { font-size: 0.8rem; color: var(--gray); }

  /* Mobile Tweaks */
  @media (max-width: 600px) {
    .grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
  }
</style>
</head>
<body>

<header>
  <a href="index.html" class="logo">STREAM</a>
  <div class="mode-switch">
    <button class="mode-btn active" id="btnMovie" onclick="switchType('movie')">Movies</button>
    <button class="mode-btn" id="btnTV" onclick="switchType('tv')">Series</button>
  </div>
</header>

<div class="search-container">
  <div class="search-bar-wrapper">
    <input id="search" placeholder="Search for a title..." oninput="handleDynamicSearch()">
  </div>
</div>

<div class="content-section">
  <h2 class="section-header" id="displayHeader">Trending <span>Movies</span></h2>
  <div id="contentGrid" class="grid">
    </div>
</div>

<script>
const API_KEY = "12955008668c12c07496b04132f9ce44";
const IMG_THUMB = "https://image.tmdb.org/t/p/w500";

let currentType = 'movie'; 
let searchTimeout = null;

async function playContent(id, title) {
  if (currentType === 'movie') {
    const res = await fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${API_KEY}`);
    const data = await res.json();
    location.href = `viewer.html?type=movie&imdb=${data.imdb_id}&title=${encodeURIComponent(title)}`;
  } else {
    location.href = `viewer.html?type=tv&id=${id}&title=${encodeURIComponent(title)}`;
  }
}

function switchType(type) {
  currentType = type;
  document.getElementById('btnMovie').classList.toggle('active', type === 'movie');
  document.getElementById('btnTV').classList.toggle('active', type === 'tv');
  
  // Update Header Text
  document.getElementById('displayHeader').innerHTML = `Trending <span>${type === 'movie' ? 'Movies' : 'Series'}</span>`;
  document.getElementById('search').value = ""; // Clear search on switch
  loadTrending();
}

async function loadTrending() {
  const res = await fetch(`https://api.themoviedb.org/3/trending/${currentType}/week?api_key=${API_KEY}`);
  const data = await res.json();
  renderGrid(data.results);
}

function handleDynamicSearch() {
  const query = document.getElementById('search').value;
  
  if (!query) {
    document.getElementById('displayHeader').innerHTML = `Trending <span>${currentType === 'movie' ? 'Movies' : 'Series'}</span>`;
    loadTrending();
    return;
  }

  // Use a timeout to avoid hitting API on every single keystroke (Debounce)
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(async () => {
    const res = await fetch(`https://api.themoviedb.org/3/search/${currentType}?api_key=${API_KEY}&query=${encodeURIComponent(query)}`);
    const data = await res.json();
    document.getElementById('displayHeader').innerHTML = `Search Results <span>${currentType === 'movie' ? 'Movies' : 'Series'}</span>`;
    renderGrid(data.results);
  }, 300);
}

function renderGrid(list) {
  const grid = document.getElementById('contentGrid');
  grid.innerHTML = "";
  
  list.forEach(item => {
    if (!item.backdrop_path) return;
    const title = item.title || item.name;
    const date = (item.release_date || item.first_air_date || "").split("-")[0];
    
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="poster" style="background-image: url(${IMG_THUMB}${item.backdrop_path})"></div>
      <div class="card-info">
        <div class="card-title">${title}</div>
        <div class="card-meta">${date} â€¢ ${currentType.toUpperCase()}</div>
      </div>
    `;
    card.onclick = () => playContent(item.id, title);
    grid.appendChild(card);
  });
}

// Initial Load
loadTrending();
</script>

</body>
</html>
