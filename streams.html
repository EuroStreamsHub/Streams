<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Football Streams</title>

<style>
/* ---------- THEME ---------- */
:root {
  --bg: linear-gradient(135deg, #369991, #2b6f6a);
  --card: #d3d3d3;
  --text: #000;
  --btn: #1f1f1f;
  --accent: #FF6700;
}

body.dark {
  --bg: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  --card: #1f1f1f;
  --text: #f1faee;
  --btn: #111;
}

/* ---------- BASE ---------- */
body {
  margin: 0;
  background: var(--bg);
  font-family: 'Segoe UI', Roboto, sans-serif;
  color: var(--text);
}

/* ---------- TOP BAR ---------- */
.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
}

.title {
  font-size: 1.6rem;
  font-weight: 800;
}

.toggle {
  background: none;
  border: 2px solid var(--text);
  border-radius: .6rem;
  padding: .35rem .8rem;
  font-weight: 600;
  cursor: pointer;
  color: var(--text);
}

/* ---------- CONTROLS ---------- */
.controls {
  text-align: center;
  padding: 1rem;
}

#search {
  width: 60%;
  max-width: 400px;
  padding: .6rem 1rem;
  border: none;
  border-radius: .4rem;
  font-weight: 600;
}

.button {
  background: var(--btn);
  color: #fff;
  border: none;
  padding: .6rem 1rem;
  margin: .2rem;
  border-radius: .5rem;
  font-weight: 600;
  cursor: pointer;
}

.button.active {
  background: var(--accent);
}

/* ---------- GRID ---------- */
.match-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  padding: 1rem;
}

.match-card {
  background: var(--card);
  border-radius: .6rem;
  text-decoration: none;
  color: var(--text);
  overflow: hidden;
  text-align: center;
  display: flex;
  flex-direction: column;
  transition: transform .2s;
}

.match-card:hover {
  transform: translateY(-4px);
}

.match-poster {
  width: 100%;
  padding-bottom: 56.25%;
  background-size: cover;
  background-position: center;
  position: relative;
}

.badge {
  position: absolute;
  top: .5rem;
  right: .5rem;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid white;
}

.badge.live { background: red; }
.badge.soon { background: orange; }

.match-teams {
  font-weight: 700;
  margin: .5rem 0 .2rem;
}

.match-time {
  margin-bottom: .6rem;
}
</style>
</head>

<body>

<div class="top-bar">
  <div class="title">Football Streams</div>
  <button class="toggle" id="themeToggle">Dark mode</button>
</div>

<div class="controls">
  <input id="search" placeholder="Search football matchesâ€¦">
  <br>
  <button class="button" id="liveBtn">Live</button>
  <button class="button" id="soonBtn">Starting Soon</button>
  <button class="button" id="popularBtn">Popular</button>
</div>

<div id="matches" class="match-grid"></div>

<script>
/* ---------- THEME ---------- */
const toggle = document.getElementById('themeToggle');

if (localStorage.getItem('theme') === 'dark') {
  document.body.classList.add('dark');
}

function updateToggleText() {
  toggle.textContent = document.body.classList.contains('dark')
    ? 'Light mode'
    : 'Dark mode';
}
updateToggleText();

toggle.onclick = () => {
  document.body.classList.toggle('dark');
  localStorage.setItem(
    'theme',
    document.body.classList.contains('dark') ? 'dark' : 'light'
  );
  updateToggleText();
};

/* ---------- STREAM LOGIC (UNCHANGED) ---------- */
const matchesDiv = document.getElementById("matches");
const searchInput = document.getElementById("search");
const liveBtn = document.getElementById("liveBtn");
const soonBtn = document.getElementById("soonBtn");
const popularBtn = document.getElementById("popularBtn");

let allMatches = [];
let liveMode = false, soonMode = false, popularMode = false;

async function fetchMatches() {
  const urls = [];
  if (popularMode) urls.push('https://streamed.pk/api/matches/football/popular');
  if (liveMode) urls.push('https://streamed.pk/api/matches/live');
  if (!urls.length) urls.push('https://streamed.pk/api/matches/football');

  const dataArrays = await Promise.all(
    urls.map(u => fetch(u).then(r => r.json()))
  );

  allMatches = dataArrays.flat().filter(m => m.category === 'football');
  render();
}

function render() {
  matchesDiv.innerHTML = '';
  const now = Date.now();
  const q = searchInput.value.toLowerCase();

  let list = allMatches.filter(m => m.title.toLowerCase().includes(q));

  if (soonMode) {
    list = list.filter(m => m.date > now && m.date - now <= 3600000);
  }

  list.forEach(m => {
    const card = document.createElement('a');
    card.className = 'match-card';

    const s = m.sources[0];
    card.href = `viewer.html?source=${s.source}&id=${s.id}&title=${encodeURIComponent(m.title)}`;

    const poster = document.createElement('div');
    poster.className = 'match-poster';
    poster.style.backgroundImage = `url(https://streamed.pk${m.poster})`;

    const badge = document.createElement('div');
    badge.className = 'badge';

    const diff = m.date - now;
    const duration = 7200000;

    if (now >= m.date && now <= m.date + duration) {
      badge.classList.add('live');
      poster.appendChild(badge);
    } else if (diff > 0 && diff <= 3600000) {
      badge.classList.add('soon');
      poster.appendChild(badge);
    }

    card.appendChild(poster);

    const teams = document.createElement('div');
    teams.className = 'match-teams';
    teams.textContent = m.teams?.home
      ? `${m.teams.home.name} vs ${m.teams.away.name}`
      : m.title;

    const time = document.createElement('div');
    time.className = 'match-time';
    time.textContent =
      now >= m.date && now <= m.date + duration ? 'LIVE' :
      diff > 0 && diff <= 3600000 ? `${Math.floor(diff / 60000)}m until kick off` :
      new Date(m.date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    card.append(teams, time);
    matchesDiv.appendChild(card);
  });
}

liveBtn.onclick = () => {
  liveMode = !liveMode;
  liveBtn.classList.toggle('active', liveMode);
  fetchMatches();
};

popularBtn.onclick = () => {
  popularMode = !popularMode;
  popularBtn.classList.toggle('active', popularMode);
  fetchMatches();
};

soonBtn.onclick = () => {
  soonMode = !soonMode;
  soonBtn.classList.toggle('active', soonMode);
  render();
};

searchInput.oninput = render;

fetchMatches();
</script>

</body>
</html>
