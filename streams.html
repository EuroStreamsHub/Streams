<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Football Streams</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background:#121212;
  color:#fff;
}

.header { text-align:center; padding:1rem; }

.controls {
  display:flex;
  justify-content:center;
  align-items:center;
  gap:1rem;
  flex-wrap:wrap;
  margin-bottom:1rem;
}

button.source-btn {
  padding:.5rem 1rem;
  border:none;
  border-radius:.4rem;
  background:#1f1f1f;
  color:#fff;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
button.source-btn.active { background:#FF6700; }

input#search {
  padding:.5rem 1rem;
  border-radius:.4rem;
  border:none;
  width:200px;
}

.button-row {
  display:flex;
  gap:.5rem;
  justify-content:center;
  margin-top:.5rem;
}

button.filter-btn {
  padding:.5rem 1rem;
  border:none;
  border-radius:.4rem;
  background:#1f1f1f;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button.filter-btn.active { background:#FF6700; }

.grid {
  display:grid;
  grid-template-columns:1fr;
  gap:.5rem;
  padding:1rem;
}

.card {
  background:#1f1f1f;
  padding:.8rem;
  border-radius:.5rem;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
  transition:.2s;
}
.card:hover { background:#333; }

.team-names { font-weight:600; }
</style>
</head>
<body>

<div class="header">
  <h2>Football Streams</h2>
  <div class="controls">
    <button class="source-btn active" data-source="streamedpk">Source 1</button>
    <button class="source-btn" data-source="topembed">Source 2</button>
    <input id="search" placeholder="Search matchesâ€¦">
  </div>
  <div class="button-row">
    <button class="filter-btn active" id="liveBtn">Live</button>
    <button class="filter-btn" id="soonBtn">Starting Soon</button>
  </div>
</div>

<div id="grid" class="grid"></div>

<script>
const grid = document.getElementById("grid");
const searchInput = document.getElementById("search");

let allMatches = [];
let selectedSource = "streamedpk";
let liveMode = true, soonMode = false;

/* ---------- SOURCE BUTTONS ---------- */
document.querySelectorAll(".source-btn").forEach(btn=>{
  btn.onclick=()=>{
    selectedSource=btn.dataset.source;
    document.querySelectorAll(".source-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    render();
  };
});

/* ---------- FILTER BUTTONS ---------- */
document.getElementById("liveBtn").onclick=()=>{
  liveMode=true;
  soonMode=false;
  document.getElementById("liveBtn").classList.add("active");
  document.getElementById("soonBtn").classList.remove("active");
  render();
};
document.getElementById("soonBtn").onclick=()=>{
  liveMode=false;
  soonMode=true;
  document.getElementById("liveBtn").classList.remove("active");
  document.getElementById("soonBtn").classList.add("active");
  render();
};
searchInput.oninput=render;

/* ---------- FETCH MATCHES ---------- */
async function fetchMatches(){
  try {
    const res = await fetch("https://beta.adstrim.ru/api/events");
    const data = await res.json();
    allMatches = data.data.filter(m=>m.sport==="Football");
    render();
  } catch(e){ console.error(e); }
}

/* ---------- RENDER ---------- */
function render(){
  grid.innerHTML="";
  const now=Date.now();
  const query = searchInput.value.toLowerCase();

  let matches = allMatches.filter(m=>m.title?.toLowerCase().includes(query) || m.home_team.toLowerCase().includes(query) || m.away_team.toLowerCase().includes(query));

  if(liveMode) matches = matches.filter(m=>m.timestamp*1000 <= now && now <= m.timestamp*1000 + m.duration*60000);
  if(soonMode) matches = matches.filter(m=>m.timestamp*1000 > now && m.timestamp*1000-now <= 3600000);

  matches.forEach(m=>{
    const card = document.createElement("div");
    card.className="card";

    const teams = document.createElement("div");
    teams.className="team-names";
    teams.textContent = `${m.home_team} vs ${m.away_team}`;

    const time = document.createElement("div");
    const diff = m.timestamp*1000 - now;
    time.textContent = liveMode?"LIVE":soonMode?`${Math.floor(diff/60000)}m until kickoff`:new Date(m.timestamp*1000).toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});

    card.appendChild(teams);
    card.appendChild(time);

    card.onclick=()=>{
      // find the selected source for this match
      const matchSource = m.channels.find(c=>c.channel_sources?.includes(selectedSource) || (selectedSource==="topembed" && !c.channel_sources)) || m.channels[0];
      const channelId = matchSource?.link;
      const matchTitle = `${m.home_team} vs ${m.away_team}`;

      window.location.href=`viewer.html?type=football&source=${selectedSource}&id=${channelId}&title=${encodeURIComponent(matchTitle)}`;
    };

    grid.appendChild(card);
  });
}

fetchMatches();
</script>
</body>
</html>
