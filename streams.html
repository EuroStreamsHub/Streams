<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Football Streams</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background: radial-gradient(circle at top, #1e1e1e, #0b0b0b);
  color:#fff;
}

/* HEADER */
.header {
  padding:1rem;
  text-align:center;
}

/* SOURCE BUTTONS */
.source-row {
  display:flex;
  justify-content:center;
  gap:0.5rem;
  margin-bottom:1rem;
}
.source-row button {
  width:40px;
  height:40px;
  border:none;
  border-radius:50%;
  background:#ff6700;
  cursor:pointer;
  transition:.2s;
}
.source-row button.active { background:#fff; }

/* SEARCH + FILTER */
.controls {
  display:flex;
  justify-content:center;
  gap:1rem;
  margin-bottom:1rem;
}
.controls input {
  padding:.6rem 1rem;
  border-radius:.4rem;
  border:none;
  width:200px;
}
.controls button {
  padding:.5rem 1rem;
  border:none;
  border-radius:.4rem;
  background:#ff6700;
  color:#000;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
.controls button.active { background:#fff; }

/* GRID */
.grid {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:1rem;
  padding:1rem;
}
@media(min-width:900px){ .grid{ grid-template-columns:repeat(3,1fr); } }
@media(min-width:1200px){ .grid{ grid-template-columns:repeat(4,1fr); } }

/* CARD */
.card {
  background:#121212;
  border-radius:.7rem;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  aspect-ratio:9/16;
  overflow:hidden;
  transition:.2s;
}
.card:hover{ transform:scale(1.03); }

.poster {
  flex:1;
  background:#333; /* placeholder */
}
.info {
  flex:.8;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  background:#181818;
  padding:.5rem;
}
.teams { font-weight:600; font-size:.95rem; }
.time { margin-top:.3rem; font-size:.85rem; opacity:.75; }
</style>
</head>
<body>

<div class="header">
  <h2>Football Streams</h2>

  <!-- SOURCE BUTTONS -->
  <div class="source-row">
    <button id="source1Btn" class="active"></button>
    <button id="source2Btn"></button>
  </div>

  <!-- SEARCH + FILTER -->
  <div class="controls">
    <input id="search" placeholder="Search matches…">
    <button id="liveBtn">Live</button>
    <button id="soonBtn">Starting Soon</button>
  </div>
</div>

<div id="grid" class="grid"></div>

<script>
const grid = document.getElementById("grid");
const searchInput = document.getElementById("search");
const liveBtn = document.getElementById("liveBtn");
const soonBtn = document.getElementById("soonBtn");
const source1Btn = document.getElementById("source1Btn");
const source2Btn = document.getElementById("source2Btn");

let activeSource = 1; // 1=streamed.pk, 2=topembed
let allMatches = [];
let liveMode = false, soonMode = false;

/* SWITCH SOURCES */
source1Btn.onclick = () => { activeSource=1; source1Btn.classList.add("active"); source2Btn.classList.remove("active"); fetchMatches(); };
source2Btn.onclick = () => { activeSource=2; source2Btn.classList.add("active"); source1Btn.classList.remove("active"); fetchMatches(); };

/* FETCH MATCHES */
async function fetchMatches() {
  grid.innerHTML = "Loading…";
  try {
    let url = activeSource===1
      ? "https://streamed.pk/api/matches/football"
      : "https://beta.adstrim.ru/api/events";

    const res = await fetch(url);
    const data = await res.json();

    if(activeSource===1){
      allMatches = data.filter(m=>m.category==="football");
    } else {
      allMatches = data.data.filter(m=>m.sport==="Football");
    }

    render();
  } catch(e){
    grid.innerHTML="Failed to load matches";
    console.error(e);
  }
}

/* RENDER GRID */
function render(){
  grid.innerHTML="";
  const now = Date.now();
  const q = searchInput.value.toLowerCase();

  let list = allMatches.filter(m=>{
    if(activeSource===1) return m.title.toLowerCase().includes(q);
    return (m.home_team+" vs "+m.away_team).toLowerCase().includes(q);
  });

  if(soonMode) list = list.filter(m=>{
    if(activeSource===1) return m.date>now && m.date-now<=3600000;
    return m.timestamp*1000>now && m.timestamp*1000-now<=3600000;
  });

  list.forEach(m=>{
    const card=document.createElement("div");
    card.className="card";

    const poster=document.createElement("div");
    poster.className="poster";
    card.appendChild(poster);

    const info=document.createElement("div");
    info.className="info";
    const teamsDiv=document.createElement("div");
    teamsDiv.className="teams";
    teamsDiv.textContent = activeSource===1 ? m.title : `${m.home_team} vs ${m.away_team}`;
    const timeDiv=document.createElement("div");
    timeDiv.className="time";
    if(activeSource===1){
      const diff = m.date-now;
      timeDiv.textContent = diff>0 && diff<=3600000 ? `${Math.floor(diff/60000)}m until kick-off` : new Date(m.date).toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});
    } else {
      const diff = m.timestamp*1000-now;
      timeDiv.textContent = diff>0 && diff<=3600000 ? `${Math.floor(diff/60000)}m until kick-off` : new Date(m.timestamp*1000).toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"});
    }

    info.appendChild(teamsDiv);
    info.appendChild(timeDiv);
    card.appendChild(info);

    // Click → viewer
    card.onclick=()=>{
      let viewerUrl="viewer.html?type=football&title=";
      viewerUrl+=encodeURIComponent(activeSource===1 ? m.title : `${m.home_team} vs ${m.away_team}`);
      if(activeSource===1) viewerUrl+=`&source=streamedpk&id=${m.sources[0]?.id}`;
      else viewerUrl+=`&channel=${m.channels[0]?.name}`;
      location.href=viewerUrl;
    };

    grid.appendChild(card);
  });
}

/* BUTTON HANDLERS */
liveBtn.onclick=()=>{ liveMode=!liveMode; liveBtn.classList.toggle("active",liveMode); render(); };
soonBtn.onclick=()=>{ soonMode=!soonMode; soonBtn.classList.toggle("active",soonMode); render(); };
searchInput.oninput=render;

fetchMatches();
</script>
</body>
</html>
