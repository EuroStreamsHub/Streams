<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Football Streams</title>
<style>
body {
  background:#369991;
  font-family:'Segoe UI',Roboto,sans-serif;
  margin:0;
  color:#000;
}
.controls {
  text-align:center;
  padding:1rem;
}
#search {
  width:60%;
  max-width:400px;
  padding:.6rem 1rem;
  border:none;
  border-radius:.4rem;
  font-weight:600;
  margin-bottom:.6rem;
}
.button {
  background:#1f1f1f;
  color:#f1faee;
  border:none;
  padding:.6rem 1rem;
  margin:.2rem;
  border-radius:.5rem;
  font-weight:600;
  cursor:pointer;
}
.button.active { background:#FF6700; }

.match-date {
  font-weight:bold;
  font-size:1.2rem;
  text-align:center;
  margin:1rem 0 .5rem 0;
}
.match-card {
  background:#d3d3d3;
  margin:.5rem 1rem;
  padding:.8rem;
  border-radius:.5rem;
  text-decoration:none;
  color:#000;
  display:block;
  text-align:center;
  position:relative;
  transition: transform 0.2s;
}
.match-card:hover { transform:translateY(-2px); }

.match-title { font-weight:bold; margin-bottom:0.3rem; }
.match-time { font-size:.9rem; margin-bottom:0.5rem; }
.badge {
  position:absolute;
  top:0.5rem;
  right:0.5rem;
  width:12px;
  height:12px;
  border-radius:50%;
}
.badge.live { background:red; }
.badge.soon { background:orange; }
</style>
</head>
<body>

<div class="controls">
  <input id="search" placeholder="Search football matchesâ€¦">
  <br>
  <button class="button" id="liveBtn">Live</button>
  <button class="button" id="soonBtn">Starting Soon</button>
  <button class="button" id="popularBtn">Popular</button>
</div>

<div id="matches"></div>

<script>
const matchesDiv = document.getElementById("matches");
const searchInput = document.getElementById("search");
const liveBtn = document.getElementById("liveBtn");
const soonBtn = document.getElementById("soonBtn");
const popularBtn = document.getElementById("popularBtn");

let allMatches = [];
let liveMode = false, soonMode = false, popularMode = false;

async function fetchMatches() {
  const urls = [];
  if (popularMode) urls.push('https://streamed.pk/api/matches/football/popular');
  if (liveMode) urls.push('https://streamed.pk/api/matches/live');
  if (!urls.length) urls.push('https://streamed.pk/api/matches/football');

  const dataArrays = await Promise.all(urls.map(u => fetch(u).then(r => r.json())));
  allMatches = dataArrays.flat().filter(m => m.category==='football');
  render();
}

function render() {
  matchesDiv.innerHTML = '';
  const now = Date.now();
  const q = searchInput.value.toLowerCase();

  let list = allMatches.filter(m => m.title.toLowerCase().includes(q));

  if (soonMode) {
    list = list.filter(m => m.date > now && m.date - now <= 60*60*1000); // <1h
  }

  const groups = {};
  list.forEach(m => {
    const d = new Date(m.date).toLocaleDateString([], {
      weekday:'long', day:'numeric', month:'short', year:'numeric'
    });
    groups[d] = groups[d] || [];
    groups[d].push(m);
  });

  for (const day in groups) {
    const dateDiv = document.createElement('div');
    dateDiv.className='match-date';
    dateDiv.textContent=day;
    matchesDiv.appendChild(dateDiv);

    groups[day].forEach(m=>{
      const card = document.createElement('a');
      card.className='match-card';
      const s = m.sources[0];
      card.href=`viewer.html?source=${s.source}&id=${s.id}&title=${encodeURIComponent(m.title)}`;

      const matchDuration = 2 * 60 * 60 * 1000; // 2h default
      const diff = m.date - now;
      let timeText = '';

      // Badge
      const badge = document.createElement('div');
      badge.className='badge';
      if (now >= m.date && now <= m.date + matchDuration) {
        timeText = new Date(m.date).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) + ' LIVE';
        badge.classList.add('live');
        card.appendChild(badge);
      } else if (diff > 0 && diff <= 60*60*1000) {
        const mins = Math.floor(diff/60000);
        timeText = `${mins}m until kick off`;
        badge.classList.add('soon');
        card.appendChild(badge);
      } else {
        timeText = new Date(m.date).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      }

      card.innerHTML += `<div class="match-title">${m.title}</div><div class="match-time">${timeText}</div>`;
      matchesDiv.appendChild(card);
    });
  }
}

// BUTTONS
liveBtn.onclick = ()=>{
  liveMode=!liveMode;
  liveBtn.classList.toggle('active',liveMode);
  fetchMatches();
};
popularBtn.onclick = ()=>{
  popularMode=!popularMode;
  popularBtn.classList.toggle('active',popularMode);
  fetchMatches();
};
soonBtn.onclick = ()=>{
  soonMode=!soonMode;
  soonBtn.classList.toggle('active',soonMode);
  render();
};

searchInput.oninput = render;

// Initial load
fetchMatches();
</script>
</body>
</html>
