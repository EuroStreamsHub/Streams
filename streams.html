<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Streams</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background:#121212;
  color:#fff;
}

h1 {
  text-align:center;
  padding:1rem;
}

.match-list {
  max-width:800px;
  margin:0 auto;
  padding:1rem;
}

.match-bar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#1f1f1f;
  margin-bottom:.5rem;
  padding:.6rem 1rem;
  border-radius:.5rem;
  cursor:pointer;
  transition:.2s;
}
.match-bar:hover {
  background:#FF6700;
}

.match-bar span {
  font-weight:600;
}
</style>
</head>
<body>

<h1>Live Matches</h1>
<div class="match-list" id="matchList">
  Loading matches...
</div>

<script>
const matchList = document.getElementById('matchList');

// Fetch TopEmbed football matches
async function loadMatches(){
  matchList.textContent = "Loading matches...";
  try {
    const res = await fetch('https://beta.adstrim.ru/api/events');
    const data = await res.json();

    matchList.innerHTML = '';
    data.data.forEach(match => {
      if(match.sport !== "Football") return; // only football
      const home = match.home_team || (match.teams?.home?.name || "Home");
      const away = match.away_team || (match.teams?.away?.name || "Away");

      // Count channels
      const channels = match.channels || [];
      const channelCount = channels.length;

      // Create bar
      const bar = document.createElement('div');
      bar.className = 'match-bar';
      bar.innerHTML = `<span>${home} vs ${away}</span><span>${channelCount} channel${channelCount !== 1 ? 's' : ''}</span>`;

      // On click, open viewer with first TopEmbed channel
      bar.onclick = () => {
        if(channelCount === 0) {
          alert("No channels available for this match.");
          return;
        }

        // pick first channel
        const firstChannel = channels[0];
        const channelName = encodeURIComponent(firstChannel.name);

        // Navigate to viewer
        window.location.href = `viewer.html?type=livetv&mirror=${channelName}&title=${encodeURIComponent(home + ' vs ' + away)}`;
      };

      matchList.appendChild(bar);
    });

    if(matchList.innerHTML === '') matchList.textContent = 'No live football matches found.';

  } catch(e){
    console.error(e);
    matchList.textContent = "Error loading matches.";
  }
}

loadMatches();
</script>

</body>
</html>
