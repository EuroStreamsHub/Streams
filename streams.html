<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Streams</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background:#121212;
  color:#fff;
  text-align:center;
}
.sources { margin:1rem 0; }
.sources button {
  margin-right:.3rem;
  padding:.4rem 1rem;
  border:none;
  border-radius:.4rem;
  cursor:pointer;
  background:#1f1f1f;
  color:#fff;
  font-weight:600;
}
.sources button.active { background:#FF6700; color:#fff; }
#search { margin:0.5rem 0 1rem; padding:.5rem; width:90%; max-width:500px; border-radius:.4rem; border:none; font-size:1rem; }

.match-bar {
  background:#1f1f1f;
  color:#fff;
  margin:0.3rem 1rem;
  padding:0.6rem;
  border-radius:.4rem;
  cursor:pointer;
  transition:.2s;
  font-weight:600;
}
.match-bar:hover { background:#FF6700; }
</style>
</head>
<body>

<h2>Live Streams</h2>

<div class="sources">
  <button id="source1" class="active">Source 1</button>
  <button id="source2">Source 2</button>
</div>

<input type="text" id="search" placeholder="Search...">

<div id="streamsContainer"></div>

<script>
let currentSource = 1; // 1=Streamed.pk, 2=TopEmbed
const streamsContainer = document.getElementById("streamsContainer");
const searchInput = document.getElementById("search");

document.getElementById("source1").onclick = ()=>{
    currentSource = 1;
    loadStreams();
    setActiveSource(1);
};
document.getElementById("source2").onclick = ()=>{
    currentSource = 2;
    loadStreams();
    setActiveSource(2);
};

function setActiveSource(n){
    document.getElementById("source1").classList.toggle("active", n===1);
    document.getElementById("source2").classList.toggle("active", n===2);
}

async function loadStreams(){
    streamsContainer.innerHTML = "Loading...";
    let data = [];

    try {
      if(currentSource===1){
        const res = await fetch('https://beta.adstrim.ru/api/events'); // streamed.pk style API
        const json = await res.json();
        data = json.data.filter(e => e.sources && e.sources.length>0 && e.category==="football");
      } else {
        const res = await fetch('https://beta.adstrim.ru/api/events'); // topembed API
        const json = await res.json();
        data = json.data.filter(e => e.channels && e.channels.length>0);
      }

      streamsContainer.innerHTML = "";

      // Shuffle to show variety
      data.sort(()=>Math.random()-0.5);

      const searchTerm = searchInput.value.toLowerCase();

      data.forEach(item=>{
          let title = item.title || `${item.teams?.home?.name || ''} vs ${item.teams?.away?.name || ''}`;
          // Remove [country] if present
          title = title.replace(/\[.*?\]/g,'').replace(/-/g,' - ').trim();
          if(searchTerm && !title.toLowerCase().includes(searchTerm)) return;

          const div = document.createElement("div");
          div.className = "match-bar";
          div.textContent = title;

          div.onclick = ()=>{
              let mirrorId, mirrorSource;
              if(currentSource===1){ // Streamed.pk
                mirrorId = item.sources[0].id;
                mirrorSource = item.sources[0].source;
              } else { // TopEmbed
                mirrorId = item.channels[0].link;
                mirrorSource = item.channels[0].name;
              }
              window.location.href = `viewer.html?type=football&source=${currentSource}&id=${mirrorId}&mirror=${mirrorSource}&title=${encodeURIComponent(title)}`;
          };

          streamsContainer.appendChild(div);
      });

    } catch(e){
      console.error(e);
      streamsContainer.innerHTML = "Error loading streams.";
    }
}

// Search updates
searchInput.addEventListener("input", loadStreams);

// Initial load
loadStreams();
</script>
</body>
</html>
