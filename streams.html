<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Football Streams</title>
<style>
body {
  background:#369991;
  font-family:'Segoe UI',Roboto,sans-serif;
  margin:0;
  color:#000;
}
.controls {
  text-align:center;
  padding:1rem;
}
#search {
  width:60%;
  max-width:400px;
  padding:.6rem 1rem;
  border:none;
  border-radius:.4rem;
  font-weight:600;
  margin-bottom:.6rem;
}
.button {
  background:#1f1f1f;
  color:#f1faee;
  border:none;
  padding:.6rem 1rem;
  margin:.2rem;
  border-radius:.5rem;
  font-weight:600;
  cursor:pointer;
}
.button.active { background:#FF6700; }

.match-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(250px,1fr));
  gap:1rem;
  padding:1rem;
}

.match-card {
  background:#d3d3d3;
  border-radius:.5rem;
  text-decoration:none;
  color:#000;
  position:relative;
  overflow:hidden;
  text-align:center;
  display:flex;
  flex-direction:column;
  transition: transform 0.2s;
}
.match-card:hover { transform:translateY(-2px); }

.match-poster {
  width:100%;
  height:0;
  padding-bottom:56.25%; /* 16:9 ratio */
  position:relative;
  background-size:cover;
  background-position:center;
}

.badge {
  position:absolute;
  top:0.5rem;
  right:0.5rem;
  width:14px;
  height:14px;
  border-radius:50%;
  border:2px solid white;
}
.badge.live { background:red; }
.badge.soon { background:orange; }

.match-teams {
  font-weight:bold;
  margin:0.5rem 0 0.2rem 0;
}

.match-time {
  font-weight:normal;
  margin-bottom:0.5rem;
}
</style>
</head>
<body>

<div class="controls">
  <input id="search" placeholder="Search football matchesâ€¦">
  <br>
  <button class="button" id="liveBtn">Live</button>
  <button class="button" id="soonBtn">Starting Soon</button>
  <button class="button" id="popularBtn">Popular</button>
</div>

<div id="matches" class="match-grid"></div>

<script>
const matchesDiv = document.getElementById("matches");
const searchInput = document.getElementById("search");
const liveBtn = document.getElementById("liveBtn");
const soonBtn = document.getElementById("soonBtn");
const popularBtn = document.getElementById("popularBtn");

let allMatches = [];
let liveMode = false, soonMode = false, popularMode = false;

async function fetchMatches() {
  const urls = [];
  if (popularMode) urls.push('https://streamed.pk/api/matches/football/popular');
  if (liveMode) urls.push('https://streamed.pk/api/matches/live');
  if (!urls.length) urls.push('https://streamed.pk/api/matches/football');

  const dataArrays = await Promise.all(urls.map(u => fetch(u).then(r => r.json())));
  allMatches = dataArrays.flat().filter(m => m.category==='football');
  render();
}

function render() {
  matchesDiv.innerHTML = '';
  const now = Date.now();
  const q = searchInput.value.toLowerCase();

  let list = allMatches.filter(m => m.title.toLowerCase().includes(q));

  if (soonMode) {
    list = list.filter(m => m.date > now && m.date - now <= 60*60*1000); // <1h
  }

  list.forEach(m => {
    const card = document.createElement('a');
    card.className='match-card';
    const s = m.sources[0];
    card.href=`viewer.html?source=${s.source}&id=${s.id}&title=${encodeURIComponent(m.title)}`;

    // Poster
    const posterDiv = document.createElement('div');
    posterDiv.className='match-poster';
    posterDiv.style.backgroundImage = `url(https://streamed.pk${m.poster})`;
    card.appendChild(posterDiv);

    // Badge on poster
    const matchDuration = 2 * 60 * 60 * 1000;
    const diff = m.date - now;
    const badgeDiv = document.createElement('div');
    badgeDiv.className='badge';
    if (now >= m.date && now <= m.date + matchDuration) {
      badgeDiv.classList.add('live');
      posterDiv.appendChild(badgeDiv);
    } else if (diff > 0 && diff <= 60*60*1000) {
      badgeDiv.classList.add('soon');
      posterDiv.appendChild(badgeDiv);
    }

    // Teams
    let teamsText = m.title;
    if (m.teams && m.teams.home && m.teams.away) {
      teamsText = `${m.teams.home.name} vs ${m.teams.away.name}`;
    }
    const teamsDiv = document.createElement('div');
    teamsDiv.className='match-teams';
    teamsDiv.textContent=teamsText;
    card.appendChild(teamsDiv);

    // Kickoff time
    let timeText='';
    if (now >= m.date && now <= m.date + matchDuration) {
      timeText='LIVE';
    } else if (diff>0 && diff<=60*60*1000) {
      const mins=Math.floor(diff/60000);
      timeText=`${mins}m until kick off`;
    } else {
      timeText=new Date(m.date).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }
    const timeDiv = document.createElement('div');
    timeDiv.className='match-time';
    timeDiv.textContent=timeText;
    card.appendChild(timeDiv);

    matchesDiv.appendChild(card);
  });
}

/* BUTTONS */
liveBtn.onclick = ()=>{
  liveMode=!liveMode;
  liveBtn.classList.toggle('active',liveMode);
  fetchMatches();
};
popularBtn.onclick = ()=>{
  popularMode=!popularMode;
  popularBtn.classList.toggle('active',popularMode);
  fetchMatches();
};
soonBtn.onclick = ()=>{
  soonMode=!soonMode;
  soonBtn.classList.toggle('active',soonMode);
  render();
};

searchInput.oninput = render;

// Initial load
fetchMatches();
</script>
</body>
</html>
