<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sports Streams</title>
<style>
body {
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background: linear-gradient(135deg,#1e1e1e,#0b0b0b);
  color:#fff;
}

/* ---------- CONTROLS ---------- */
.controls {
  display:flex;
  flex-wrap:wrap;
  justify-content:space-between;
  align-items:center;
  padding:1rem;
  gap:.5rem;
}

.controls input, .controls select {
  padding:.6rem 1rem;
  border-radius:.4rem;
  border:none;
  font-weight:600;
}

.controls input {
  flex:1 1 50%;
}

.controls select {
  flex:1 1 45%;
  background:#1f1f1f;
  color:#fff;
  cursor:pointer;
}

/* ---------- FILTER BUTTONS ---------- */
.button-group {
  text-align:center;
  margin-bottom:1rem;
}

.button {
  background:#1f1f1f;
  color:#fff;
  border:none;
  padding:.6rem 1rem;
  margin:.2rem;
  border-radius:.5rem;
  font-weight:600;
  cursor:pointer;
}

.button.active { background:#FF6700; }

/* ---------- GRID ---------- */
.match-grid {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:1rem;
  padding:1rem;
}

@media(min-width:900px){ .match-grid{ grid-template-columns:repeat(3,1fr); } }
@media(min-width:1200px){ .match-grid{ grid-template-columns:repeat(4,1fr); } }

/* ---------- MATCH CARD ---------- */
.match-card {
  background:#121212;
  border-radius:.7rem;
  cursor:pointer;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  transition:.2s;
  aspect-ratio:9/16;
}

.match-card:hover{ transform:scale(1.03); }

/* Poster top half */
.match-poster {
  flex:1;
  background:#222;
  background-size:cover;
  background-position:center;
  position:relative;
}

/* Badge */
.badge {
  position:absolute;
  top:.5rem;
  right:.5rem;
  width:14px;
  height:14px;
  border-radius:50%;
  border:2px solid white;
}
.badge.live { background:red; }
.badge.soon { background:orange; }

/* Match info bottom half */
.match-info {
  padding:.4rem;
  background:#1a1a1a;
  text-align:center;
}
.match-teams { font-weight:bold; font-size:.95rem; margin-bottom:.2rem; }
.match-time { font-size:.85rem; color:#ccc; }
</style>
</head>
<body>

<div class="controls">
  <input id="search" placeholder="Search matchesâ€¦">
  <select id="sportSelect"></select>
</div>

<div class="button-group">
  <button class="button" id="liveBtn">Live</button>
  <button class="button" id="soonBtn">Starting Soon</button>
  <button class="button" id="popularBtn">Popular</button>
</div>

<div id="matches" class="match-grid"></div>

<script>
const matchesDiv = document.getElementById("matches");
const searchInput = document.getElementById("search");
const sportSelect = document.getElementById("sportSelect");
const liveBtn = document.getElementById("liveBtn");
const soonBtn = document.getElementById("soonBtn");
const popularBtn = document.getElementById("popularBtn");

let allMatches = [];
let sportsList = [];
let liveMode=false, soonMode=false, popularMode=false;
let currentSport = 'football';

/* Fetch sports categories */
async function fetchSports() {
  try {
    const res = await fetch('https://streamed.pk/api/sports');
    sportsList = await res.json();
    sportSelect.innerHTML = sportsList.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
    sportSelect.value = currentSport;
  } catch(e){
    console.error("Failed to fetch sports:", e);
    sportSelect.innerHTML = `<option value="football">Football</option>`;
  }
}

/* Fetch matches based on current sport + filters */
async function fetchMatches() {
  const urls = [];
  if(popularMode) urls.push(`https://streamed.pk/api/matches/${currentSport}/popular`);
  if(liveMode) urls.push(`https://streamed.pk/api/matches/live`);
  if(!urls.length) urls.push(`https://streamed.pk/api/matches/${currentSport}`);

  try {
    const dataArrays = await Promise.all(urls.map(u=>fetch(u).then(r=>r.json())));
    allMatches = dataArrays.flat().filter(m=>m.category===currentSport);
    render();
  } catch(err){
    console.error("Failed to fetch matches:", err);
    matchesDiv.innerHTML = "<p style='text-align:center;color:red;'>Failed to load matches</p>";
  }
}

/* Render matches grid */
function render() {
  matchesDiv.innerHTML = '';
  const now = Date.now();
  const q = searchInput.value.toLowerCase();

  let list = allMatches.filter(m => m.title.toLowerCase().includes(q));

  if(soonMode){
    list = list.filter(m=>m.date>now && m.date-now<=60*60*1000); // <1h
  }

  list.forEach(m=>{
    const card = document.createElement('a');
    card.className='match-card';
    const s = m.sources[0];
    card.href=`viewer.html?type=${currentSport}&source=${s.source}&id=${s.id}&title=${encodeURIComponent(m.title)}`;

    const posterDiv = document.createElement('div');
    posterDiv.className='match-poster';
    posterDiv.style.backgroundImage = `url(https://streamed.pk${m.poster})`;

    // badge
    const matchDuration = 2*60*60*1000;
    const diff = m.date-now;
    const badgeDiv = document.createElement('div');
    badgeDiv.className='badge';
    if(now>=m.date && now<=m.date+matchDuration) badgeDiv.classList.add('live');
    else if(diff>0 && diff<=60*60*1000) badgeDiv.classList.add('soon');
    if(badgeDiv.classList.length>0) posterDiv.appendChild(badgeDiv);

    card.appendChild(posterDiv);

    const infoDiv = document.createElement('div');
    infoDiv.className='match-info';

    let teamsText = m.title;
    if(m.teams && m.teams.home && m.teams.away){
      teamsText = `${m.teams.home.name} vs ${m.teams.away.name}`;
    }
    const teamsDiv = document.createElement('div');
    teamsDiv.className='match-teams';
    teamsDiv.textContent = teamsText;

    let timeText='';
    if(now>=m.date && now<=m.date+matchDuration) timeText='LIVE';
    else if(diff>0 && diff<=60*60*1000) timeText=`${Math.floor(diff/60000)}m until kick off`;
    else timeText=new Date(m.date).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const timeDiv = document.createElement('div');
    timeDiv.className='match-time';
    timeDiv.textContent = timeText;

    infoDiv.appendChild(teamsDiv);
    infoDiv.appendChild(timeDiv);
    card.appendChild(infoDiv);

    matchesDiv.appendChild(card);
  });

  if(list.length===0){
    matchesDiv.innerHTML = "<p style='text-align:center;opacity:.6;'>No matches found</p>";
  }
}

/* Event listeners */
liveBtn.onclick = ()=>{
  liveMode=!liveMode;
  liveBtn.classList.toggle('active',liveMode);
  fetchMatches();
};
popularBtn.onclick = ()=>{
  popularMode=!popularMode;
  popularBtn.classList.toggle('active',popularMode);
  fetchMatches();
};
soonBtn.onclick = ()=>{
  soonMode=!soonMode;
  soonBtn.classList.toggle('active',soonMode);
  render();
};

searchInput.oninput = render;
sportSelect.onchange = ()=>{
  currentSport = sportSelect.value;
  fetchMatches();
};

/* Initial load */
fetchSports().then(fetchMatches);
</script>

</body>
</html>
