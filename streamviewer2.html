<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stream Viewer</title>

<style>
:root {
  --primary:#00d2ff;
  --bg:#0a0a0a;
  --surface:#1a1a1a;
  --border:#333;
}

body {
  margin:0;
  background:var(--bg);
  color:white;
  font-family:system-ui,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
}

/* TOP */
.top {
  width:100%;
  padding:1.2rem 4%;
}

.back {
  text-decoration:none;
  color:white;
  background:rgba(255,255,255,.1);
  padding:8px 14px;
  border-radius:6px;
  font-weight:700;
}

/* TITLE */
h2 {
  margin:.5rem 0 1rem;
  text-align:center;
}

/* PLAYER */
.player-wrap {
  width:95%;
  max-width:1200px;
  background:black;
  border-radius:10px;
  overflow:hidden;
  border:1px solid var(--border);
}

.aspect {
  position:relative;
  aspect-ratio:16/9;
}

iframe {
  width:100%;
  height:100%;
  border:none;
}

/* LOADER */
.loader {
  position:absolute;
  top:50%;
  left:50%;
  width:50px;
  height:50px;
  border:3px solid rgba(255,255,255,.1);
  border-top:3px solid var(--primary);
  border-radius:50%;
  transform:translate(-50%,-50%);
  animation:spin 1s linear infinite;
  z-index:2;
}

@keyframes spin {
  to { transform:translate(-50%,-50%) rotate(360deg); }
}

/* MIRRORS */
.mirrors {
  width:95%;
  max-width:1200px;
  margin-top:1rem;
}

.grid {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}

.btn {
  background:#222;
  border:1px solid var(--border);
  color:white;
  padding:10px 16px;
  border-radius:6px;
  cursor:pointer;
  font-weight:700;
}

.btn.active {
  border-color:var(--primary);
  color:var(--primary);
}
</style>
</head>

<body>

<div class="top">
  <a class="back" href="https://eurostreamshub.github.io/Streams/streams2.html">
    ⬅ Back
  </a>
</div>

<h2 id="title">Loading…</h2>

<div class="player-wrap">
  <div class="aspect">
    <div id="loader" class="loader"></div>
    <iframe id="player"
      allowfullscreen
      sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox">
    </iframe>
  </div>
</div>

<div class="mirrors">
  <div style="color:#888;margin:.5rem 0;">CHANNELS</div>
  <div class="grid" id="mirrorGrid"></div>
</div>

<script>
const params = new URLSearchParams(location.search);
const title = params.get("title") || "Live Event";
const sources = JSON.parse(decodeURIComponent(params.get("sources") || "[]"));

const player = document.getElementById("player");
const loader = document.getElementById("loader");
const grid = document.getElementById("mirrorGrid");

document.getElementById("title").textContent = title;

function load(url, btn) {
  loader.style.display = "block";
  player.src = url;
  document.querySelectorAll(".btn").forEach(b => b.classList.remove("active"));
  if (btn) btn.classList.add("active");
}

player.onload = () => loader.style.display = "none";

/* BUILD EMBEDS (CORRECT LOGIC) */
const counters = {};

sources.forEach((s, i) => {
  counters[s.source] = (counters[s.source] || 0) + 1;
  const index = counters[s.source];

  const embed =
    `https://embedsports.top/embed/${s.source}/${s.id}/${index}`;

  const btn = document.createElement("button");
  btn.className = "btn";
  btn.textContent = `${s.source.toUpperCase()} ${index}`;
  btn.onclick = () => load(embed, btn);

  if (i === 0) btn.classList.add("active");
  grid.appendChild(btn);
});

if (sources.length) {
  load(
    `https://embedsports.top/embed/${sources[0].source}/${sources[0].id}/1`,
    grid.firstChild
  );
}
</script>

</body>
</html>
