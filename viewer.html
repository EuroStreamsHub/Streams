<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stream Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Arial, Helvetica, sans-serif;
    }

    body {
      background: #000;
      color: #fff;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 10px 15px;
      background: #111;
      border-bottom: 1px solid #222;
      text-align: center;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    #player-container {
      position: relative;
      flex: 1;
      background: #000;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: #000;
    }

    #loader {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.85);
      z-index: 10;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid #333;
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body>

<header id="title">Loadingâ€¦</header>

<div id="player-container">
  <div id="loader">
    <div class="spinner"></div>
  </div>

  <iframe id="player" allowfullscreen allow="autoplay; fullscreen"></iframe>
</div>

<script>
  const params = new URLSearchParams(window.location.search);

  const type    = params.get("type");
  const title   = params.get("title") || "";
  const imdb    = params.get("imdb");
  const mirror  = params.get("mirror");
  const channel = params.get("channel");

  const player  = document.getElementById("player");
  const loader  = document.getElementById("loader");
  const titleEl = document.getElementById("title");

  titleEl.textContent = decodeURIComponent(title || "Stream Viewer");

  loader.style.display = "flex";

  /* =========================
     MOVIES
  ========================= */
  if (type === "movie") {
    if (!imdb) {
      alert("Movie ID not provided");
      loader.style.display = "none";
    } else {
      const cleanId = imdb.replace(/^tt/, "");
      player.src = `https://vidfast.pro/movie/${cleanId}`;
    }
  }

  /* =========================
     LIVE TV (TopEmbed)
  ========================= */
  else if (type === "livetv") {
    const liveChannel = mirror || channel;

    if (!liveChannel) {
      alert("Channel not provided");
      loader.style.display = "none";
    } else {
      const encoded = encodeURIComponent(liveChannel);
      player.src = `https://topembed.pw/channel/${encoded}`;
    }
  }

  /* =========================
     INVALID TYPE
  ========================= */
  else {
    alert("Invalid stream type");
    loader.style.display = "none";
  }

  /* =========================
     LOADER HANDLING
  ========================= */
  player.onload = () => {
    loader.style.display = "none";
  };
</script>

</body>
</html>
