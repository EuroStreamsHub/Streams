<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Match Viewer</title>
<style>
body {
  background:#369991; /* match page background */
  color:#000; /* black text for bars/cards */
  font-family:'Segoe UI',Roboto,sans-serif;
  padding:1rem;
  text-align:center;
  margin:0;
}
.back-button {
  display:inline-block;
  margin:0.5rem auto 1rem auto;
  padding:.6rem 1rem;
  background:#1f1f1f; /* same style as match cards */
  color:#f1faee;
  border:none;
  border-radius:.5rem;
  font-weight:600;
  cursor:pointer;
  text-decoration:none;
  transition:.2s;
}
.back-button:hover { filter:brightness(1.2); }
h2 {
  margin-bottom:.5rem;
  font-weight:bold;
}
.description {
  font-size:0.95rem;
  margin-bottom:1rem;
  color:#000;
}
.source-buttons {
  display:flex;
  gap:.3rem;
  flex-wrap:wrap;
  justify-content:center;
  margin-bottom:1rem;
}
.button {
  background:#1f1f1f;
  color:#f1faee;
  padding:.5rem .9rem;
  border:none;
  border-radius:.5rem;
  font-weight:600;
  cursor:pointer;
  transition:.2s;
}
.button:hover { filter:brightness(1.2); }
.stream-container {
  width:90%;
  max-width:1000px;
  aspect-ratio:16/9;
  background:#000;
  margin:0 auto;
  position:relative;
  border-radius:.5rem;
  overflow:hidden;
}
iframe {
  width:100%;
  height:100%;
  border:none;
}
.loader {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  border:6px solid rgba(255,255,255,0.1);
  border-top:6px solid #FF6700; /* match page accent color */
  border-radius:50%;
  width:50px;
  height:50px;
  animation:spin 1s linear infinite;
  display:none;
  z-index:5;
}
@keyframes spin {0%{transform:translate(-50%,-50%) rotate(0deg);}100%{transform:translate(-50%,-50%) rotate(360deg);}}

.vpn-banner {
  background:#d3d3d3; /* same as match bars */
  border:1px solid #1f1f1f;
  padding:1rem;
  margin:1rem auto;
  border-radius:.5rem;
  max-width:600px;
  display:none;
  font-size:.95rem;
  line-height:1.4;
  color:#000;
}
.vpn-banner a {
  color:#1f1f1f;
  font-weight:bold;
  text-decoration:none;
}
.vpn-banner a:hover { text-decoration:underline; }
</style>
</head>
<body>

<a href="index.html" class="back-button">‚¨Ö Back to Matches</a>

<!-- VPN Banner -->
<div id="vpn-banner" class="vpn-banner"></div>

<h2 id="match-title">Loading...</h2>
<div class="description" id="match-description"></div>

<div class="source-buttons" id="source-buttons"></div>
<div class="stream-container">
  <div class="loader" id="loader"></div>
  <iframe id="stream-iframe" allowfullscreen></iframe>
</div>

<script>
const API_BASE="https://streamed.pk/api";
const iframe = document.getElementById("stream-iframe");
const loader = document.getElementById("loader");
const sourceButtons = document.getElementById("source-buttons");
const matchTitle = document.getElementById("match-title");
const matchDescription = document.getElementById("match-description");

// Get match object from URL
const urlParams = new URLSearchParams(window.location.search);
const matchParam = urlParams.get("match");
const match = matchParam ? JSON.parse(decodeURIComponent(matchParam)) : null;

if(!match){
  matchTitle.textContent = "No match selected";
}else{
  matchTitle.textContent = match.title || ((match.teams?.home?.name || "TBD") + " vs " + (match.teams?.away?.name || "TBD"));
  const ko = match.date ? new Date(match.date).toLocaleString([], {weekday:'short', day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'}) : "TBD";
  matchDescription.textContent = `Kick-off: ${ko}${match.description ? " ‚Äî " + match.description : ""}`;

  const sources = match.sources || [];
  if(sources.length > 0){
    sources.slice(0,6).forEach((s,i)=>{
      const btn = document.createElement("button");
      btn.className = "button";
      btn.textContent = `Link ${i+1}`;
      btn.onclick = () => loadStream(s);
      sourceButtons.appendChild(btn);
    });
    loadStream(sources[0]);
  }
}

function loadStream(src){
  loader.style.display = "block";
  fetch(`${API_BASE}/stream/${src.source}/${src.id}`)
    .then(res => res.json())
    .then(arr => {
      iframe.src = arr[0]?.embedUrl || "";
    })
    .catch(err=>{
      console.error(err);
      iframe.src = "";
    })
    .finally(()=>{ loader.style.display = "none"; });
}

// VPN Banner
async function detectLocation() {
  try {
    const res = await fetch("https://ipapi.co/json/");
    const data = await res.json();
    const banner = document.getElementById("vpn-banner");
    banner.innerHTML = `
      ‚ö†Ô∏è It looks like you're visiting from <b>${data.country_name}</b>.<br>
      Some streams may not work in your region.<br>
      üëâ <a href="https://refer-nordvpn.com/BoZjAlNeKcb" target="_blank">
        Get NordVPN to unlock all matches
      </a>
    `;
    banner.style.display = "block";
  } catch(e) {
    console.error("VPN banner error:", e);
  }
}
detectLocation();
</script>

</body>
</html>
