<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Football Stream</title>

<style>
body {
  background:#369991;
  font-family:'Segoe UI',Roboto,sans-serif;
  margin:0;
  text-align:center;
}
.back-button {
  display:inline-block;
  margin:1rem;
  background:#1f1f1f;
  color:#fff;
  padding:.6rem 1rem;
  border-radius:.5rem;
  text-decoration:none;
}
.stream-container {
  max-width:1000px;
  aspect-ratio:16/9;
  margin:0 auto;
  background:#000;
  position:relative;
  border-radius:.5rem;
  overflow:hidden;
}
iframe {
  width:100%;
  height:100%;
  border:none;
}
.loader {
  position:absolute;
  top:50%;
  left:50%;
  width:50px;
  height:50px;
  border:6px solid rgba(255,255,255,.2);
  border-top:6px solid #FF6700;
  border-radius:50%;
  transform:translate(-50%,-50%);
  animation:spin 1s linear infinite;
}
@keyframes spin {
  to { transform:translate(-50%,-50%) rotate(360deg); }
}
.sources {
  margin:1rem;
  display:flex;
  gap:.5rem;
  justify-content:center;
  flex-wrap:wrap;
}
.source-btn {
  background:#1f1f1f;
  color:#fff;
  padding:.4rem .8rem;
  border-radius:.4rem;
  cursor:pointer;
}
.source-btn.active {
  background:#FF6700;
}
</style>
</head>

<body>

<a class="back-button" href="streams.html">â¬… Back</a>
<h2 id="title"></h2>

<div class="stream-container">
  <div class="loader" id="loader"></div>
  <iframe id="player" allowfullscreen></iframe>
</div>

<div class="sources" id="sources"></div>

<script>
const params = new URLSearchParams(location.search);
const sourceParam = params.get("source");
const idParam = params.get("id");
const title = params.get("title");

document.getElementById("title").textContent =
  title ? decodeURIComponent(title) : "Football Stream";

const player = document.getElementById("player");
const loader = document.getElementById("loader");
const sourcesDiv = document.getElementById("sources");

async function loadStream(source, id, btn) {
  loader.style.display = "block";
  document.querySelectorAll(".source-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");

  const res = await fetch(`https://streamed.pk/api/stream/${source}/${id}`);
  const streams = await res.json();

  const best =
    streams.find(s => s.hd && s.language === "English") ||
    streams.find(s => s.hd) ||
    streams[0];

  player.src = best.embedUrl;
  player.onload = () => loader.style.display = "none";
}

async function init() {
  const res = await fetch("https://streamed.pk/api/matches/football");
  const matches = await res.json();

  const match = matches.find(m =>
    m.sources.some(s => s.id === idParam)
  );
  if (!match) return;

  match.sources.forEach((s, i) => {
    const btn = document.createElement("div");
    btn.className = "source-btn";
    btn.textContent = s.source.toUpperCase();
    btn.onclick = () => loadStream(s.source, s.id, btn);
    sourcesDiv.appendChild(btn);
    if (i === 0) loadStream(s.source, s.id, btn);
  });
}

init();
</script>

</body>
</html>
